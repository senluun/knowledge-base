"use strict";(self["webpackChunkhabr_web"]=self["webpackChunkhabr_web"]||[]).push([[5106],{80271:(e,t,i)=>{i.d(t,{A:()=>r});var s=i(62931),a=i(66252),n=i(80546);function o(e){const t=1,i={[n.lo.wrapSelection]:({wrapper:e="",attributesString:i})=>{const s=/^<([a-zA-Z0-9]+)>$/.test(e),a=s?e.replace("<","</"):e;return i&&s&&(e=e.replace(">",` ${i}>`)),{transform:t=>`${e}${t}${a}`,getSelection:({start:s,end:n,isEmpty:o})=>{if(i&&!o){const i=e.indexOf('"');return{start:s+i+t,end:s+e.indexOf('"',i+1)}}return o?s+e.length:n+a.length+e.length+t}}},[n.lo.insertBefore]:({insertion:e=""})=>({transform:t=>`${e}${t}`,getSelection:({start:t,isEmpty:i,selectedText:s})=>i?t+e.length:t+s.length+e.length}),[n.lo.insertAfter]:({insertion:e=""})=>({transform:t=>`${t}${e}`,getSelection:({end:t})=>t+e.length}),[n.lo.insertLink]:()=>{const e="url",i=t=>{const i=(0,n.K2)(t);return i?`[${t}](${i.toString()})`:`[${t}](${e})`},s=({start:i,isEmpty:s,transformedText:a,selectedText:o})=>{if((0,n.K2)(o))return{start:i+t+1,end:i+o.length};const r=s?i+t:i+a.indexOf(e),l=s?r:r+e.length;return{start:r,end:l}};return{transform:i,getSelection:s}},[n.lo.insertImage]:()=>{const e="url",t=t=>(0,n.KT)(t)?`![${t}](${t} "${t}")`:`![${t}](${e} "${t}")`,i=({start:t,isEmpty:i,transformedText:s,selectedText:a})=>{const o=2;if((0,n.KT)(a))return{start:t+o,end:t+a.length+o};const r=i?t+o:t+s.indexOf(e),l=i?r:r+e.length;return{start:r,end:l}};return{transform:t,getSelection:i}},[n.lo.insertLine]:()=>({transform:e=>`${e}---\n`,getSelection:({end:e,transformedText:t})=>e+t.length}),[n.lo.insertEmbed]:()=>{const e='<iframe src="';return{transform:t=>`${e}${t}"></iframe>`,getSelection:({selectedText:i,transformedText:s,start:a,isEmpty:o})=>{let r;return r=(0,n.K2)(i)?a+s.length+t:o?a+e.length+t:a+e.length+i.length,r}}},[n.lo.insertList]:({type:e})=>{const i=t=>t.trim()?"bullet"===e?t.split("\n").map((e=>`- ${e.trimEnd()}`)).join("\n"):t.split("\n").map(((e,t)=>(0,n.r9)(e,t+1))).join("\n"):"bullet"===e?"- ":"1. ";return{transform:i,getSelection:({start:e,transformedText:i})=>e+i.length+t}},[n.lo.insertTable]:()=>{const e=3,i=t=>{const i=t.split("\n"),s=Math.max(...i.map((e=>e.length))),a=s<e?e:s;return i.map(((e,t)=>{const i=Array.from({length:a}).fill(" ").join("");if(0===t){const t=Array.from({length:a}).fill("-").join(""),s=`| ${e.trim()} |${i}|`,n=`| ${t} | ${t} |`;return`${s}\n${n}\n`}return e.trim()?`| ${e} | ${i} |\n`:""})).join("")};return{transform:i,getSelection:({start:e,isEmpty:i,transformedText:s})=>i?e+1+t:e+s.length+t}},[n.lo.insertPersona]:()=>{const t=t=>{let i;if((0,n.KT)(t))return i=`<persona>\n\t<img src="${t}" />\n\t<h5>title</h5>\n\t<p>description</p>\n</persona>`,e.value.length?`\n${i}`:i;if(t.includes("\n")){const e=t.split("\n").map((e=>e.trim())).filter(Boolean);let s="",a=e.shift()||"";(0,n.KT)(a)&&(s=a,a=e.shift()||"");const o=e.join("");i=`<persona>\n\t<img src="${s||""}" />\n\t<h5>${a}</h5>\n\t<p>${o}</p>\n\n</persona>`}else i='<persona>\n\t<img src="" />\n\t<h5>title</h5>\n\t<p>description</p>\n</persona>';return e.value.length?`\n${i}`:i};return{transform:t,getSelection:({transformedText:e,start:t})=>t+e.length}}};return i}function r(e,t={initialText:""}){const{initialText:i}=t,r=(0,s.iH)(i||""),l=o(r);function u({name:e,attributes:t}){if("function"===typeof l[e]){const i=l[e],{transform:s,getSelection:a}=i(t??{}),n=d(s);if(n){const e=a(n);m((null===e||void 0===e?void 0:e.start)||e,(null===e||void 0===e?void 0:e.end)||e)}p()}}function d(t){var i,s,a,n,o;if(void 0===r.value)return null;const l=null===(i=e.value)||void 0===i?void 0:i.selectionStart,u=null===(s=e.value)||void 0===s?void 0:s.selectionEnd,d=null===(a=r.value)||void 0===a?void 0:a.slice(l,u),c=t(d);return r.value=`${null===(n=r.value)||void 0===n?void 0:n.slice(0,l)}${c}${null===(o=r.value)||void 0===o?void 0:o.slice(u)}`,{start:l,end:u,isEmpty:l===u,selectedText:d,transformedText:c}}const c=(0,s.iH)({start:0,end:0});function m(e,t){c.value={start:e,end:t}}(0,a.YP)(c,(async({start:t,end:i})=>{(0,a.Y3)((()=>{e.value.focus(),requestAnimationFrame((()=>{e.value.setSelectionRange(t,i??t)}))}))}));const h=(0,n.Gq)(15);function p(){h.save({selection:{start:e.value.selectionStart,end:e.value.selectionEnd},text:r.value})}function g(){const e=h.prev();e&&(r.value=e.text,c.value=e.selection)}function f(){const e=h.next();e&&(r.value=e.text,c.value=e.selection)}function v(e){if((e.ctrlKey||e.metaKey)&&["z","я"].includes(e.key.toLowerCase())&&!e.shiftKey)return e.preventDefault(),void g();if(e.shiftKey&&e.metaKey&&["z","я"].includes(e.key.toLowerCase()))return e.preventDefault(),void f();if(e.ctrlKey&&["y","н"].includes(e.key.toLowerCase()))return e.preventDefault(),void f();if("Tab"===e.key){const{handlers:i}=t;i.tab&&(e.preventDefault(),i.tab())}}function _(){var t,i,s,a;null===(t=(i=e.value).addEventListener)||void 0===t||t.call(i,"keydown",v),null===(s=(a=e.value).addEventListener)||void 0===s||s.call(a,"input",p)}function T(){var t,i,s,a;null===(t=(i=e.value).removeEventListener)||void 0===t||t.call(i,"keydown",v),null===(s=(a=e.value).removeEventListener)||void 0===s||s.call(a,"input",p)}return(0,a.bv)((()=>{h.save({selection:{start:r.value.length,end:r.value.length},text:r.value})})),(0,a.bv)((()=>{e.value&&_()})),(0,a.Jd)((()=>{e.value&&T()})),(0,a.YP)(e,((e,t)=>{var i,s;t&&(null===(i=t.removeEventListener)||void 0===i||i.call(t,"keydown",v),null===(s=t.removeEventListener)||void 0===s||s.call(t,"input",p));null!==e&&_()})),{markdownText:r,executeCommand:u,undo:g,redo:f,updateMarkdownSelection:m}}},46329:(e,t,i)=>{i.d(t,{c:()=>n,i:()=>o});var s=i(86598);const a={id:null,variantTitle:"",fakeCheckbox:null,fakeRadio:null};function n(){return{id:null,title:"",variants:[{...a},{...a}],isMultiple:!1,isTimed:!1,endDateTime:null}}function o(e,t,i,a={titleMaxLength:1/0,variantsMaxLength:1/0,variantsMinLength:2,denyDelete:null}){return[{className:"tm-input",label:e("POLLS_SUBJECT_PLACEHOLDER"),htmlAttrs:{placeholder:e("POLLS_SUBJECT")},name:"title",type:"BaseInput",position:{row:"1",column:"1 / 7"},validation:{required:!0,minLength:1,maxLength:a.titleMaxLength}},{type:"DynamicInputs",name:"variants",label:e("POLLS_VARIANTS"),denyDelete:null!==a.denyDelete?a.denyDelete:!!t,validation:{required:!0,minLength:a.variantsMinLength,maxLength:a.variantsMaxLength},position:{row:"2",column:"1 / 7"},addLabel:e("POLLS_VARIANTS_ADD"),fields:[{className:"tm-checkbox",name:"fakeCheckbox",type:"BaseCheckbox",disabled:!0,defaultValue:!1,validation:{required:!1},displayConditions:[{fieldName:"isMultiple",values:[!0]}]},{className:"tm-radio",name:"fakeRadio",type:"BaseRadio",disabled:!0,defaultValue:null,validation:{required:!1},options:[{name:null,value:!1}],displayConditions:[{fieldName:"isMultiple",values:[!1]}]},{className:"tm-input",name:"variantTitle",type:"BaseInput",htmlAttrs:{placeholder:e("POLLS_VARIANT_PLACEHOLDER")},validation:{required:!0,minLength:1,maxLength:a.maxLength}},{name:"id",type:"BaseHidden"}]},{className:"tm-checkbox",dynamicName:`isMultiple${i}`,name:"isMultiple",type:"BaseCheckbox",label:e("POLLS_VARIANTS_MULTIPLE"),defaultValue:!1,position:{row:"3",column:"1 / 7"},validation:{required:!1}},{className:"tm-checkbox",dynamicName:`isTimed${i}`,name:"isTimed",type:"BaseCheckbox",label:e("POLLS_VARIANTS_TIMED"),defaultValue:!1,position:{row:"4",column:"1 / 7"},breakpoint:{1024:{position:{row:"4",column:"auto / auto"}}},validation:{required:!1}},{className:"tm-datetime",name:"endDateTime",type:"BaseDatetime",withTime:!0,disabledBefore:new Date,defaultValue:s.Ro.toISOString(),position:{row:"5",column:"1 / 7"},breakpoint:{1024:{position:{row:"4",column:"auto / auto"}}},validation:{required:!1},displayConditions:[{fieldName:"isTimed",values:[!0]}]},{className:"tm-section",name:"PollBorder",label:"",type:"BaseSection",position:{row:"6",column:"1 / 7"}},{name:"id",type:"BaseHidden"}]}},80546:(e,t,i)=>{i.d(t,{Ft:()=>d,Gq:()=>u,K2:()=>o,KT:()=>r,fB:()=>c,lo:()=>s,r9:()=>l});const s={wrapSelection:"wrapSelection",insertBefore:"insertBefore",insertAfter:"insertAfter",insertLink:"insertLink",insertLine:"insertLine",insertEmbed:"insertEmbed",insertImage:"insertImage",insertList:"insertList",insertTable:"insertTable",insertPersona:"insertPersona"};function a(e,t=""){return{name:s.wrapSelection,attributes:{wrapper:e,attributesString:t}}}function n(e){return{name:s.insertBefore,attributes:{insertion:e}}}function o(e){try{const t=new URL(e.trim());return t}catch{return!1}}function r(e){const t=o(e);return t&&/\.(jpeg|jpg|gif|png|webp|bmp|svg|tiff|avif?)$/i.test(t.pathname)}function l(e,t){const i=e.match(/^(\d+)(\.?)(.*)$/);if(!i)return`${t}. ${e}`;const s=parseInt(i[1],10),a=i[3].replace(/^\s*/,""),n=`${t}.`;return s!==t?`${n} ${a}`.trim():`${s}. ${a}`.trim()}a("**"),a("*"),a("<u>"),a("~~"),a("<sub>"),a("<sup>"),a("??"),n("# "),n("## "),n("### "),s.insertLink,a("<abbr>",'title="title"'),n("> "),s.insertList,s.insertList,s.insertEmbed,s.insertImage,s.insertLine,s.insertTable,a("```"),a("`"),a("$$inline$$"),a("$$"),a("<spoiler>",'title="title"'),a("<anchor>"),s.insertPersona;function u(e=10){let t=[],i=-1;return{save({selection:s,text:a}){i<t.length-1&&(t=t.slice(0,i+1)),t.push({selection:s,text:a}),t.length>e?t.shift():i+=1},prev(){return i>0?(i-=1,t[i]):null},next(){return i<t.length-1?(i+=1,t[i]):null}}}const d=[{icon:"format",submenu:[{icon:"bold",command:a("**"),hotkeys:["ctrl+B","ctrl+И"]},{icon:"italic",command:a("*"),hotkeys:["ctrl+I","ctrl+Ш"]},{icon:"underline",command:a("<u>"),hotkeys:["ctrl+U","ctrl+Г"]},{icon:"strike",command:a("~~"),hotkeys:["alt+shift+5"]},{icon:"sub",command:a("<sub>"),hotkeys:["ctrl+.","ctrl+Ю"]},{icon:"sup",command:a("<sup>"),hotkeys:["ctrl+,","ctrl+Б"]},{icon:"hidden",command:a("||"),hotkeys:["ctrl+shift+P","ctrl+shift+З"]}]},{icon:"headings",submenu:[{icon:"heading1",command:n("# ")},{icon:"heading2",command:n("## ")},{icon:"heading3",command:n("### ")}]},{icon:"link",command:{name:s.insertLink}},{icon:"abbr",command:a("<abbr>",'title="title"')},{icon:"blockquote",command:{name:s.insertBefore,attributes:{insertion:"> "}}},{icon:"lists",submenu:[{icon:"bullet-list",command:{name:s.insertList,attributes:{type:"bullet"}}},{icon:"ordered-list",command:{name:s.insertList,attributes:{type:"ordered"}}}]},{icon:"embed",command:{name:s.insertEmbed}},{icon:"image",command:{name:s.insertImage}},{icon:"hr",command:{name:s.insertLine}},{icon:"table",command:{name:s.insertTable}},{icon:"code",submenu:[{icon:"codeblock",command:a("```")},{icon:"source",command:a("`")}]},{icon:"formula",submenu:[{icon:"formula-source",command:a("$inline$")},{icon:"formula",command:a("$$display$$")}]},{icon:"spoiler",command:a("<spoiler>",'title="title"')},{icon:"anchor",command:a("<anchor>")},{icon:"persona",command:{name:s.insertPersona}}],c=[{icon:"format",submenu:[{icon:"bold",command:a("**"),hotkeys:["ctrl+B","ctrl+И"]},{icon:"italic",command:a("*"),hotkeys:["ctrl+I","ctrl+Ш"]},{icon:"underline",command:a("<u>"),hotkeys:["ctrl+U","ctrl+Г"]},{icon:"strike",command:a("~~"),hotkeys:["alt+shift+5"]},{icon:"sub",command:a("<sub>"),hotkeys:["ctrl+.","ctrl+Ю"]},{icon:"sup",command:a("<sup>"),hotkeys:["ctrl+,","ctrl+Б"]},{icon:"hidden",command:a("||"),hotkeys:["ctrl+shift+P","ctrl+shift+З"]}]},{icon:"link",command:{name:s.insertLink}},{icon:"abbr",command:a("<abbr>",'title="title"')},{icon:"blockquote",command:{name:s.insertBefore,attributes:{insertion:"> "}}},{icon:"lists",submenu:[{icon:"bullet-list",command:{name:s.insertList,attributes:{type:"bullet"}}},{icon:"ordered-list",command:{name:s.insertList,attributes:{type:"ordered"}}}]},{icon:"embed",command:{name:s.insertEmbed}},{icon:"image",command:{name:s.insertImage}},{icon:"code",submenu:[{icon:"codeblock",command:a("```")},{icon:"source",command:a("`")}]},{icon:"formula-source",command:a("$inline$")}]},88048:(e,t,i)=>{i.d(t,{G:()=>s});const s=[{value:"mega-post",name:"TYPE_MEGAPOST"},{value:"mega-test",name:"TYPE_MEGATEST"},{value:"mega-quest",name:"TYPE_MEGAQUEST"},{value:"combo",name:"TYPE_COMBO"},{value:"poll",name:"TYPE_POLL"},{value:"it-comics",name:"TYPE_COMICS"},{value:"it-rebus",name:"TYPE_REBUS"}]},89507:(e,t,i)=>{i.d(t,{i:()=>l});var s=i(64487),a=i(67476),n=i(86409),o=i(10707);function r(e){return(0,n.Hm)((0,o.k)("refs/flows/wysiwyg","v2"),{publicationId:e})}const l=(0,a.Q_)("refs",{state:()=>({specializationRefs:[]}),actions:{async loadSpecializationRefs(e){try{const{flows:t}=await r(e);return t&&(this.specializationRefs=t),t}catch(t){console.error(t),(0,s.uT)(t)}return[]}}})},68357:(e,t,i)=>{i.d(t,{C2:()=>n,Uc:()=>o,a$:()=>d,a_:()=>c,ao:()=>u,db:()=>l,uU:()=>m,v3:()=>h,yV:()=>r});var s=i(86409),a=i(10707);function n(e,t){return(0,s.Q)((0,a.k)(`sandbox/posts/${e}/reject`,"v2"),t)}function o(e,t){return(0,s.Q)((0,a.k)(`sandbox/posts/${e}/rework`,"v2"),t)}function r(e,t){return(0,s.Q)((0,a.k)(`sandbox/posts/${e}/send_invite`,"v2"),t)}function l(e,t,i){const n=t?`sandbox/save/${t}`:"sandbox/save";return(0,s.Q)((0,a.k)(n,"v2"),{...e,idempotenceKey:i})}function u(e){return(0,s.Q)((0,a.k)(`sandbox/posts/${e}/approve`,"v2"))}function d(e){return(0,s.Hm)((0,a.k)(`sandbox/post-data/${e}`,"v2"))}function c(e){return(0,s.Hm)((0,a.k)("sandbox/refs/reject_reasons","v2"),{hl:e})}function m(e){return(0,s.Hm)((0,a.k)("sandbox/refs/rework_reasons","v2"),{hl:e})}function h(e){return(0,s.Q)((0,a.k)(`sandbox/posts/${e}/cancel_delayed_publish`,"v2"))}},94423:(e,t,i)=>{i.d(t,{Z:()=>C});var s=i(66252),a=i(56612),n=i(58061),o=i(62931),r=i(66309),l=i(2372),u=i(51714),d=i(39639),c=i(36134);const m={key:0,class:"label"},h={key:0,class:"required"},p=["disabled","placeholder","value","onKeydown"],g={class:"loading"},f={class:"icon"},v=["onClick","onMouseenter"],_={key:1,class:"no-options"},T={key:1,class:"meta"},b={key:0,class:"error"},w={__name:"base-autocomplete",props:{modelValue:{type:Object,default:()=>({})},search:{type:String,default:""},placeholder:{type:String,default:""},options:{type:Array,default:()=>[]},loading:Boolean,disabled:Boolean,noOptionsKey:{type:String,default:"SEARCH_EMPTY_COMMON"},maxHeight:{type:[Number,String],default:99},clearable:Boolean,required:Boolean,label:{type:String,default:""},description:{type:String,default:""},error:{type:String,default:""},validation:{type:Array,default:()=>[]}},emits:["update:modelValue","update:search","update:error","clear","resetSearch"],setup(e,{expose:t,emit:i}){const w=e,I=i;t({validateOption:z});const{msg:A}=(0,c.Q)(),C=(0,o.iH)(),E=(0,o.iH)(null),y=(0,o.iH)(-1);function D(){E.value.close(),y.value=-1}const L=(0,o.iH)([]),S=(0,s.Fl)((()=>A(w.noOptionsKey))),M=(0,s.Fl)((()=>{var e;return null!==(e=w.modelValue)&&void 0!==e&&e.value&&!w.options.length?[w.modelValue]:w.options}));function P(e){j(),I("update:modelValue",e),H.value=e.text,z(e),D()}function O(){if(y.value>=0&&y.value<L.value.length){const e=L.value[y.value];e.scrollIntoView({block:"nearest",inline:"start"})}}function k(){y.value<M.value.length-1&&(y.value+=1,O())}function N(){y.value>0&&(y.value-=1,O())}function B(){y.value>=0&&P(M.value[y.value])}const F=(0,s.Fl)((()=>"number"===typeof w.maxHeight?`${w.maxHeight}px`:w.maxHeight));function U(e,t){return{highlighted:t===y.value,selected:w.modelValue.value===e}}const x=(0,o.iH)();function R(){x.value.focus()}function W(){j(),y.value=-1,E.value.open()}function $(){(0,s.Y3)((()=>{z(w.modelValue)}))}const H=(0,o.iH)(w.search);function Y(e){var t;const i=(null===(t=e.target)||void 0===t?void 0:t.value)??"";""!==i&&(y.value=-1,E.value.open()),H.value=i,I("update:search",i.trim())}const G=(0,s.Fl)((()=>w.clearable&&!w.loading&&H.value.length));function V(){I("clear"),H.value="",I("update:error",""),D()}function q(){H.value=w.modelValue.text??"",D()}function j(){I("update:error","")}function z(e){if(w.validation)for(let t=0;t<w.validation.length;t+=1){const i=w.validation[t],s=i(e);if(s){I("update:error",s);break}}}return(0,r.i9H)(C,(()=>{q(),I("resetSearch")})),(t,i)=>((0,s.wg)(),(0,s.iD)("div",{id:"autocomplete-select",ref_key:"autocomplete",ref:C,class:"base-autocomplete"},[e.label?((0,s.wg)(),(0,s.iD)("div",m,[e.required?((0,s.wg)(),(0,s.iD)("span",h," *  ")):(0,s.kq)("",!0),(0,s._)("span",null,(0,a.zw)(e.label),1)])):(0,s.kq)("",!0),(0,s.Wm)(u.Z,{ref_key:"dropdown",ref:E,class:"dropdown"},{head:(0,s.w5)((()=>[(0,s._)("div",{class:(0,a.C_)(["input-wrapper",{disabled:e.disabled}]),onClick:R},[(0,s._)("input",{ref_key:"inputRef",ref:x,class:"input",disabled:e.disabled,placeholder:e.placeholder,type:"text",value:H.value,onBlur:$,onFocus:W,onInput:Y,onKeydown:[(0,n.D2)((0,n.iM)(k,["prevent"]),["down"]),(0,n.D2)((0,n.iM)(B,["prevent"]),["enter"]),(0,n.D2)((0,n.iM)(N,["prevent"]),["up"])]},null,40,p),e.loading?(0,s.WI)(t.$slots,"loading",{key:0},(()=>[(0,s._)("div",g,[(0,s.Wm)(l.Z,{"circle-height":16,"circle-width":16,size:16,width:16})])])):(0,s.kq)("",!0),G.value?((0,s.wg)(),(0,s.iD)("div",{key:1,class:"clear",onClick:(0,n.iM)(V,["stop"])},[(0,s.Wm)(d.Z,{id:"close",size:14,title:(0,o.SU)(A)("ICON_CLEAR")},null,8,["title"])])):(0,s.kq)("",!0),(0,s._)("div",f,[(0,s.WI)(t.$slots,"icon")])],2)])),body:(0,s.w5)((()=>[(0,s._)("div",{class:"options",style:(0,a.j5)({maxHeight:F.value})},[M.value.length?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(M.value,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t,ref_for:!0,ref_key:"optionsRefs",ref:L,class:(0,a.C_)(["option",U(e,t)]),onClick:t=>P(e),onMouseenter:e=>y.value=t,onMouseleave:i[0]||(i[0]=e=>y.value=-1)},(0,a.zw)(e.text),43,v)))),128)):((0,s.wg)(),(0,s.iD)("div",_,(0,a.zw)(S.value),1))],4)])),_:3},512),e.description||e.error?((0,s.wg)(),(0,s.iD)("div",T,[e.error?((0,s.wg)(),(0,s.iD)("span",b,(0,a.zw)(e.error),1)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Uk)((0,a.zw)(e.description),1)],64))])):(0,s.kq)("",!0)],512))}};var I=i(83744);const A=(0,I.Z)(w,[["__scopeId","data-v-c622c040"]]),C=A},7452:(e,t,i)=>{i.d(t,{Z:()=>m});var s=i(66252),a=i(56612),n=i(62931),o=i(20666),r=i(15564),l=i(36134);const u=(0,s.aZ)({__name:"autosave-info",props:{title:{},savedDate:{}},emits:["restoreDraft"],setup(e){const t={level:"info",message:null,isPermanent:!0},{msg:i}=(0,l.Q)();return(e,l)=>((0,s.wg)(),(0,s.j4)(r["default"],{bordered:"",class:"autosave-info",notice:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.title)+" ",1),(0,s.Wm)(o.Z,{date:new Date(e.savedDate),"show-full-date-time":!0},null,8,["date"]),(0,s._)("a",{class:"restore",onClick:l[0]||(l[0]=t=>e.$emit("restoreDraft"))},(0,a.zw)((0,n.SU)(i)("PUBLICATION_SAVED_DRAFT_RESTORE")),1)])),_:1}))}});var d=i(83744);const c=(0,d.Z)(u,[["__scopeId","data-v-4a78a623"]]),m=c},2648:(e,t,i)=>{i.d(t,{Z:()=>M});var s=i(66252),a=i(58061),n=i(62931),o=i(56612),r=i(67476),l=i(84183);const u=16,d={__name:"md-editor-panel-scroller",setup(e){const t=(0,n.iH)(null),i=(0,n.iH)(null);let d=!1,c=0,m=0;const h=(0,n.iH)(0),p=(0,l.s)(),{isDesktop:g}=(0,r.Jk)(p);function f(){return t.value&&i.value?t.value.offsetWidth-i.value.scrollWidth-u:0}function v(e){h.value=Math.max(f(),Math.min(e,0))}function _(e){d&&(e.preventDefault(),m=e.clientX-c,v(m))}function T(){d=!1,window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",T)}function b(e){g.value||(d=!0,c=e.touches[0].clientX-h.value)}function w(e){d&&(m=e.touches[0].clientX-c,v(m))}function I(){d=!1}function A(){v(h.value)}return(0,s.YP)(g,(e=>{e&&v(0)})),(0,s.bv)((()=>{window.addEventListener("resize",A)})),(0,s.Jd)((()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",T),window.removeEventListener("resize",A)})),(e,n)=>((0,s.wg)(),(0,s.iD)("div",{ref_key:"scroller",ref:t,class:"md-panel-scroller",onTouchend:(0,a.iM)(I,["stop"]),onTouchmove:(0,a.iM)(w,["stop"]),onTouchstart:(0,a.iM)(b,["stop"])},[(0,s._)("div",{ref_key:"content",ref:i,class:"scroll-content",style:(0,o.j5)({transform:`translateX(${h.value}px)`})},[(0,s.WI)(e.$slots,"default")],4)],544))}};var c=i(83744);const m=(0,c.Z)(d,[["__scopeId","data-v-5fde4d98"]]),h=m;var p=i(81864);const g={class:"sub-panel"},f={__name:"md-editor-subpanel",props:{target:{type:"undefined"===typeof window?null:HTMLButtonElement,default:null},container:{type:"undefined"===typeof window?null:HTMLDivElement,default:null}},emits:["close"],setup(e){const t=e,i=(0,s.Fl)((()=>[{name:"offset",options:{offset:[0,8]}},{name:"preventOverflow",options:{boundary:t.container,padding:{right:12,left:12}}},{name:"arrow",options:{element:".arrow",padding:{left:20,right:20}}}]));return(t,a)=>((0,s.wg)(),(0,s.j4)(p.Z,{class:"popover","custom-modifiers":i.value,placement:"top",root:e.target,onClose:a[0]||(a[0]=e=>t.$emit("close"))},{default:(0,s.w5)((()=>[(0,s._)("div",g,[(0,s.WI)(t.$slots,"default"),a[1]||(a[1]=(0,s._)("div",{class:"arrow"},null,-1))])])),_:3},8,["custom-modifiers","root"]))}},v=(0,c.Z)(f,[["__scopeId","data-v-dfcbc28b"]]),_=v;function T(){const e=["a[href]","button:not([disabled])","textarea:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])",'[tabindex]:not([tabindex="-1"])'],t=Array.from(document.querySelectorAll(e.join(","))).filter((e=>null!==e.offsetParent&&e.tabIndex>=0)),i=t.indexOf(document.activeElement)+1,s=t[i];s&&"function"===typeof s.focus&&s.focus()}var b=i(10877),w=i(36134);const I={ref:"buttonWrapperRef",class:"md-editor-button-wrapper"},A=["title"],C=Object.assign({inheritAttrs:!1},{__name:"md-editor-button",props:{selected:Boolean,icon:{type:String,required:!0},command:{type:Object,validator:e=>!!e.name},hotkeys:{type:Array,default:()=>[]},position:{type:Number,default:0}},setup(e,{expose:t}){const i=e,a=(0,n.iH)(null);t({buttonRef:a});const{msg:o}=(0,w.Q)();function r(e){if(!e)return"";const t=e.replace(/\s+/g,"_").replace(/-/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").replace(/[^a-zA-Z0-9_]/g,"").toUpperCase();return o(`ICON_${t}`)}const l=(0,s.Fl)((()=>i.icon?r(i.icon):""));return(t,i)=>((0,s.wg)(),(0,s.iD)("div",I,[(0,s._)("button",(0,s.dG)({ref_key:"buttonRef",ref:a,class:["md-editor-button",{selected:e.selected&&t.$slots["sub-panel"],focused:e.selected&&!t.$slots["sub-panel"]}],title:l.value},t.$attrs),[(0,s.Wm)(b.Z,{icon:e.icon},null,8,["icon"])],16,A),(0,s.WI)(t.$slots,"sub-panel")],512))}}),E=(0,c.Z)(C,[["__scopeId","data-v-9c65dd61"]]),y=E,D={class:"buttons"},L={__name:"md-editor-panel",props:{buttons:{type:Array,default:()=>[]},subpanelContainer:{required:!0}},emits:["command","reset"],setup(e,{expose:t,emit:i}){var o;const r=e,l=i,u=(0,s.Fl)((()=>r.buttons)),d=(0,n.iH)(-1),c=(0,s.Fl)((()=>u.value[d.value]??null)),m=(0,n.iH)([]),p=(0,s.Fl)((()=>{var e;return d.value>=0?null===(e=m.value[d.value])||void 0===e?void 0:e.buttonRef:null})),g=(0,n.iH)(-1),f=(0,n.iH)(!1);function v(){c.value.submenu&&(0,s.Y3)((()=>{f.value=!0}))}function b(){f.value=!1,g.value=-1}const w=(0,n.iH)(!1);function I(){w.value=!0}const A=(0,n.iH)(null);function C(){w.value=!1,d.value=-1,b(),l("reset")}function E(){C(),T()}function L(e){A.value.contains(e.target)||C()}t({focus:I,blur:E}),(0,s.bv)((()=>{document.addEventListener("click",L)})),(0,s.Jd)((()=>{document.removeEventListener("click",L)}));const S={Enter:P,Escape:C,Tab:O,ArrowRight:N,ArrowLeft:B,ArrowDown:U,ArrowUp:F};function M(e){if(!w.value||e.ctrlKey||e.altKey)return;const{key:t}=e;if("Tab"===t&&e.shiftKey)return e.preventDefault(),void k();S[t]&&(e.preventDefault(),S[t]())}function P(){var e;g.value<0?x(c.value,d.value):R(null===(e=c.value)||void 0===e?void 0:e.submenu[g.value])}function O(){var e,t,i;d.value>=u.value.length-1?E():null!==(e=c.value)&&void 0!==e&&e.submenu&&g.value!==(null===(t=c.value)||void 0===t?void 0:t.submenu.length)-1?g.value+=1:(d.value+=1,null!==(i=c.value)&&void 0!==i&&i.submenu?(v(),g.value=0):(g.value=-1,v()))}function k(){var e,t;if(w.value){if(null!==(e=c.value)&&void 0!==e&&e.submenu){if(0!==g.value)return void(g.value-=1);b()}d.value-=1,d.value<0?C():null!==(t=c.value)&&void 0!==t&&t.submenu&&(0,s.Y3)((()=>{var e;f.value=!0,g.value=(null===(e=c.value)||void 0===e?void 0:e.submenu.length)-1}))}}function N(){var e,t;g.value>=0?g.value>=(null===(e=c.value)||void 0===e||null===(t=e.submenu)||void 0===t?void 0:t.length)-1?g.value=0:g.value+=1:(d.value>=u.value.length-1?d.value=0:d.value+=1,d.value>=0&&v())}function B(){var e,t;g.value>=0?0===g.value?g.value=(null===(e=c.value)||void 0===e||null===(t=e.submenu)||void 0===t?void 0:t.length)-1:g.value-=1:(0===d.value?d.value=u.value.length-1:d.value-=1,v())}function F(){var e;null!==(e=c.value)&&void 0!==e&&e.submenu&&(g.value=0,v())}function U(){var e;null!==(e=c.value)&&void 0!==e&&e.submenu&&(0,s.Y3)((()=>{b()}))}function x(e,t){var i;if(d.value=t,null!==e&&void 0!==e&&null!==(i=e.submenu)&&void 0!==i&&i.length)return w.value=!0,void(f.value=!0);e.command&&(l("command",e.command),d.value=-1)}function R(e){e.command&&(l("command",e.command),C())}function W(e,t){return null!==e&&void 0!==e&&e.length?e.map((i=>{const s=i.split("+"),a=s.find((e=>!["ctrl","alt","shift"].includes(e)));if(!a)return console.warn(`Markdown Editor Button:\n      hotkeys doesn't have any keys available for binding, please check: ${t}, ${e}`),null;const n=s.includes("ctrl"),o=s.includes("alt"),r=s.includes("shift");return{targetKey:a,needAlt:o,needShift:r,needCtrl:n,command:t}})).filter(Boolean):[]}(0,s.bv)((()=>{document.addEventListener("keydown",M)})),(0,s.Jd)((()=>{document.removeEventListener("keydown",M)}));const $=null===(o=u.value)||void 0===o?void 0:o.map((e=>{const t=e.submenu?e.submenu.flatMap((({hotkeys:e,command:t})=>W(e,t))):W(e.hotkeys,e.command);return t}));function H(e){return navigator.platform.indexOf("Mac")>-1&&e.metaKey||e.ctrlKey}function Y(e){$.flat().forEach((({targetKey:t,needAlt:i,needShift:s,needCtrl:a,command:n})=>{const{altKey:o,shiftKey:r}=e;a===H(e)&&i===o&&s===r&&e.key.toLowerCase()===t.toLowerCase()&&(e.stopPropagation(),e.preventDefault(),l("command",n))}))}return(0,s.bv)((()=>{document.addEventListener("keydown",Y)})),(0,s.Jd)((()=>{document.removeEventListener("keydown",Y)})),(t,i)=>((0,s.wg)(),(0,s.j4)(h,{class:"scroller"},{default:(0,s.w5)((()=>[(0,s._)("div",{ref_key:"panelRef",ref:A,class:"md-editor-panel"},[(0,s._)("div",D,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(u.value,((t,n)=>((0,s.wg)(),(0,s.j4)(y,{key:t.icon,ref_for:!0,ref_key:"buttonRefs",ref:m,class:"button",command:t.command,hotkeys:t.hotkeys??[],icon:t.icon,position:n,selected:d.value===n,tabindex:"-1",onClick:(0,a.iM)((e=>x(t,n)),["prevent"]),onMousedown:i[2]||(i[2]=(0,a.iM)((()=>{}),["prevent"]))},(0,s.Nv)({_:2},[t.submenu?{name:"sub-panel",fn:(0,s.w5)((()=>[f.value&&p.value&&d.value===n?((0,s.wg)(),(0,s.j4)(_,{key:0,container:e.subpanelContainer,target:p.value,onClose:C},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.submenu,((e,t)=>((0,s.wg)(),(0,s.j4)(y,(0,s.dG)({key:e.icon},{ref_for:!0},e,{selected:g.value===t,onClick:(0,a.iM)((t=>R(e)),["stop","prevent"]),onHotkey:i[0]||(i[0]=e=>l("command",e)),onMousedown:i[1]||(i[1]=(0,a.iM)((()=>{}),["prevent"]))}),null,16,["selected","onClick"])))),128))])),_:2},1032,["container","target"])):(0,s.kq)("",!0)])),key:"0"}:void 0]),1032,["command","hotkeys","icon","position","selected","onClick"])))),128))])],512)])),_:1}))}},S=(0,c.Z)(L,[["__scopeId","data-v-58928014"]]),M=S},28485:(e,t,i)=>{i.d(t,{Z:()=>S});var s=i(66252);const a=["innerHTML"],n=["innerHTML"],o={class:"tm-publication-sidebar__advice"},r=["innerHTML"],l={class:"tm-publication-sidebar__advice"},u=["innerHTML"],d={key:0,class:"tm-publication-sidebar__advice"},c=["innerHTML"],m={class:"tm-publication-sidebar__advice"},h=["innerHTML"],p=["innerHTML"];function g(e,t,i,g,f,v){const _=(0,s.up)("TMBlock"),T=(0,s.up)("TMFollowRulesIcon"),b=(0,s.up)("TMFollowAdviceIcon"),w=(0,s.up)("TMUseHubIcon"),I=(0,s.up)("TMImageSizeIcon"),A=(0,s.up)("TMLayoutSidebar");return v.isDesktop?((0,s.wg)(),(0,s.j4)(A,{key:0},{default:(0,s.w5)((()=>["ru"!==g.langOptions.hl||i.isSandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(_,{key:0,title:"Хабр ищет авторов"},{default:(0,s.w5)((()=>t[0]||(t[0]=[(0,s._)("div",{class:"tm-publication-sidebar__authors-block-wrapper"},[(0,s._)("p",null," Мы ищем авторов в контент-студию — помогать компаниям делать крутые статьи для техноблогов и мегапроекты. "),(0,s._)("p",null,[(0,s.Uk)(" Хотите писать не только на Хабр, но и для Хабра? "),(0,s._)("a",{class:"link",href:"https://habr.typeform.com/to/B6F56KNn#from=wysiwyg",rel:"noopener",target:"_blank"}," Давайте познакомимся! ")])],-1)]))),_:1,__:[0]})),i.isSandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(_,{key:1,title:e.msg("PUBLICATION_BETA_TITLE")},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"tm-publication-sidebar__beta",innerHTML:e.msg("PUBLICATION_BETA")},null,8,a)])),_:1},8,["title"])),i.isSandbox?((0,s.wg)(),(0,s.j4)(_,{key:2,title:e.msg("TITLE_BLOCK_SANDBOX_ABOUT")},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"tm-publication-sidebar__sandbox-about",innerHTML:e.msg("SANDBOX_SIDEBAR_ABOUT")},null,8,n)])),_:1},8,["title"])):(0,s.kq)("",!0),(0,s.Wm)(_,{title:e.msg("PUBLICATION_ADVICE_TITLE")},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s.Wm)(T),(0,s._)("div",{innerHTML:e.msg("PUBLICATION_FOLLOW_RULES")},null,8,r)]),(0,s._)("div",l,[(0,s.Wm)(b),(0,s._)("div",{innerHTML:e.msg("PUBLICATION_FOLLOW_ADVICE")},null,8,u)]),i.isSandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",d,[(0,s.Wm)(w),(0,s._)("div",{innerHTML:e.msg("PUBLICATION_USE_HUB")},null,8,c)])),(0,s._)("div",m,[(0,s.Wm)(I),(0,s._)("div",{innerHTML:e.msg("PUBLICATION_IMAGE_SIZE")},null,8,h)])])),_:1},8,["title"]),i.isSandbox?((0,s.wg)(),(0,s.j4)(_,{key:3,title:e.msg("TITLE_BLOCK_SANDBOX_ABOUT_MODERATION")},{default:(0,s.w5)((()=>[(0,s._)("div",{class:"tm-publication-sidebar__sandbox-verification",innerHTML:e.msg("SANDBOX_MODERATION_BLOCK_TEXT_CONTENT",{careerHost:e.$options.CAREER_HOST,qnaHost:e.$options.QNA_HOST,freelHost:e.$options.FREEL_HOST})},null,8,p)])),_:1},8,["title"])):(0,s.kq)("",!0)])),_:1})):(0,s.kq)("",!0)}var f=i(70352),v=i(59545),_=i(67118),T=i(36134),b=i(84183),w=i(35275);const I=(0,v.Rd)((()=>i.e(128).then(i.bind(i,65831))),v.MN),A=(0,v.Rd)((()=>i.e(128).then(i.bind(i,17392))),v.MN),C=(0,v.Rd)((()=>i.e(128).then(i.bind(i,71346))),v.MN),E=(0,v.Rd)((()=>i.e(128).then(i.bind(i,93197))),v.MN),y={name:"TMPublicationSidebar",components:{TMLayoutSidebar:_.Z,TMBlock:f.Z,TMFollowRulesIcon:I,TMFollowAdviceIcon:A,TMUseHubIcon:C,TMImageSizeIcon:E},props:{isSandbox:{type:Boolean,default:!1}},setup(){const{langOptions:e}=(0,T.Q)();return{langOptions:e}},CAREER_HOST:w.Yu,QNA_HOST:w.QO,FREEL_HOST:w.I0,computed:{isDesktop(){return(0,b.s)().isDesktop},oldEditorLink(){return`https://habr.com/${this.langOptions.hl}/topic/add`}}};var D=i(83744);const L=(0,D.Z)(y,[["render",g]]),S=L},40653:(e,t,i)=>{i.d(t,{Z:()=>Oe});var s=i(66252),a=i(62931);function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===f(e)}const o=1/0;function r(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-o?"-0":t}function l(e){return null==e?"":r(e)}function u(e){return"string"===typeof e}function d(e){return"number"===typeof e}function c(e){return!0===e||!1===e||h(e)&&"[object Boolean]"==f(e)}function m(e){return"object"===typeof e}function h(e){return m(e)&&null!==e}function p(e){return void 0!==e&&null!==e}function g(e){return!e.trim().length}function f(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const v="Incorrect 'index' type",_=e=>`Invalid value for key ${e}`,T=e=>`Pattern length exceeds max of ${e}.`,b=e=>`Missing ${e} property in key`,w=e=>`Property 'weight' in key '${e}' must be a positive integer`,I=Object.prototype.hasOwnProperty;class A{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach((e=>{let i=C(e);this._keys.push(i),this._keyMap[i.id]=i,t+=i.weight})),this._keys.forEach((e=>{e.weight/=t}))}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function C(e){let t=null,i=null,s=null,a=1,o=null;if(u(e)||n(e))s=e,t=E(e),i=y(e);else{if(!I.call(e,"name"))throw new Error(b("name"));const n=e.name;if(s=n,I.call(e,"weight")&&(a=e.weight,a<=0))throw new Error(w(n));t=E(n),i=y(n),o=e.getFn}return{path:t,id:i,weight:a,src:s,getFn:o}}function E(e){return n(e)?e:e.split(".")}function y(e){return n(e)?e.join("."):e}function D(e,t){let i=[],s=!1;const a=(e,t,o)=>{if(p(e))if(t[o]){let r=t[o];const m=e[r];if(!p(m))return;if(o===t.length-1&&(u(m)||d(m)||c(m)))i.push(l(m));else if(n(m)){s=!0;for(let e=0,i=m.length;e<i;e+=1)a(m[e],t,o+1)}else t.length&&a(m,t,o+1)}else i.push(e)};return a(e,u(t)?t.split("."):t,0),s?i:i[0]}const L={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},S={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},M={location:0,threshold:.6,distance:100},P={useExtendedSearch:!1,getFn:D,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var O={...S,...L,...M,...P};const k=/[^ ]+/g;function N(e=1,t=3){const i=new Map,s=Math.pow(10,t);return{get(t){const a=t.match(k).length;if(i.has(a))return i.get(a);const n=1/Math.pow(a,.5*e),o=parseFloat(Math.round(n*s)/s);return i.set(a,o),o},clear(){i.clear()}}}class B{constructor({getFn:e=O.getFn,fieldNormWeight:t=O.fieldNormWeight}={}){this.norm=N(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach(((e,t)=>{this._keysMap[e.id]=t}))}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,u(this.docs[0])?this.docs.forEach(((e,t)=>{this._addString(e,t)})):this.docs.forEach(((e,t)=>{this._addObject(e,t)})),this.norm.clear())}add(e){const t=this.size();u(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,i=this.size();t<i;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!p(e)||g(e))return;let i={v:e,i:t,n:this.norm.get(e)};this.records.push(i)}_addObject(e,t){let i={i:t,$:{}};this.keys.forEach(((t,s)=>{let a=t.getFn?t.getFn(e):this.getFn(e,t.path);if(p(a))if(n(a)){let e=[];const t=[{nestedArrIndex:-1,value:a}];while(t.length){const{nestedArrIndex:i,value:s}=t.pop();if(p(s))if(u(s)&&!g(s)){let t={v:s,i,n:this.norm.get(s)};e.push(t)}else n(s)&&s.forEach(((e,i)=>{t.push({nestedArrIndex:i,value:e})}))}i.$[s]=e}else if(u(a)&&!g(a)){let e={v:a,n:this.norm.get(a)};i.$[s]=e}})),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function F(e,t,{getFn:i=O.getFn,fieldNormWeight:s=O.fieldNormWeight}={}){const a=new B({getFn:i,fieldNormWeight:s});return a.setKeys(e.map(C)),a.setSources(t),a.create(),a}function U(e,{getFn:t=O.getFn,fieldNormWeight:i=O.fieldNormWeight}={}){const{keys:s,records:a}=e,n=new B({getFn:t,fieldNormWeight:i});return n.setKeys(s),n.setIndexRecords(a),n}function x(e,{errors:t=0,currentLocation:i=0,expectedLocation:s=0,distance:a=O.distance,ignoreLocation:n=O.ignoreLocation}={}){const o=t/e.length;if(n)return o;const r=Math.abs(s-i);return a?o+r/a:r?1:o}function R(e=[],t=O.minMatchCharLength){let i=[],s=-1,a=-1,n=0;for(let o=e.length;n<o;n+=1){let o=e[n];o&&-1===s?s=n:o||-1===s||(a=n-1,a-s+1>=t&&i.push([s,a]),s=-1)}return e[n-1]&&n-s>=t&&i.push([s,n-1]),i}const W=32;function $(e,t,i,{location:s=O.location,distance:a=O.distance,threshold:n=O.threshold,findAllMatches:o=O.findAllMatches,minMatchCharLength:r=O.minMatchCharLength,includeMatches:l=O.includeMatches,ignoreLocation:u=O.ignoreLocation}={}){if(t.length>W)throw new Error(T(W));const d=t.length,c=e.length,m=Math.max(0,Math.min(s,c));let h=n,p=m;const g=r>1||l,f=g?Array(c):[];let v;while((v=e.indexOf(t,p))>-1){let e=x(t,{currentLocation:v,expectedLocation:m,distance:a,ignoreLocation:u});if(h=Math.min(e,h),p=v+d,g){let e=0;while(e<d)f[v+e]=1,e+=1}}p=-1;let _=[],b=1,w=d+c;const I=1<<d-1;for(let T=0;T<d;T+=1){let s=0,n=w;while(s<n){const e=x(t,{errors:T,currentLocation:m+n,expectedLocation:m,distance:a,ignoreLocation:u});e<=h?s=n:w=n,n=Math.floor((w-s)/2+s)}w=n;let r=Math.max(1,m-n+1),l=o?c:Math.min(m+n,c)+d,v=Array(l+2);v[l+1]=(1<<T)-1;for(let o=l;o>=r;o-=1){let s=o-1,n=i[e.charAt(s)];if(g&&(f[s]=+!!n),v[o]=(v[o+1]<<1|1)&n,T&&(v[o]|=(_[o+1]|_[o])<<1|1|_[o+1]),v[o]&I&&(b=x(t,{errors:T,currentLocation:s,expectedLocation:m,distance:a,ignoreLocation:u}),b<=h)){if(h=b,p=s,p<=m)break;r=Math.max(1,2*m-p)}}const A=x(t,{errors:T+1,currentLocation:m,expectedLocation:m,distance:a,ignoreLocation:u});if(A>h)break;_=v}const A={isMatch:p>=0,score:Math.max(.001,b)};if(g){const e=R(f,r);e.length?l&&(A.indices=e):A.isMatch=!1}return A}function H(e){let t={};for(let i=0,s=e.length;i<s;i+=1){const a=e.charAt(i);t[a]=(t[a]||0)|1<<s-i-1}return t}const Y=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class G{constructor(e,{location:t=O.location,threshold:i=O.threshold,distance:s=O.distance,includeMatches:a=O.includeMatches,findAllMatches:n=O.findAllMatches,minMatchCharLength:o=O.minMatchCharLength,isCaseSensitive:r=O.isCaseSensitive,ignoreDiacritics:l=O.ignoreDiacritics,ignoreLocation:u=O.ignoreLocation}={}){if(this.options={location:t,threshold:i,distance:s,includeMatches:a,findAllMatches:n,minMatchCharLength:o,isCaseSensitive:r,ignoreDiacritics:l,ignoreLocation:u},e=r?e:e.toLowerCase(),e=l?Y(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const d=(e,t)=>{this.chunks.push({pattern:e,alphabet:H(e),startIndex:t})},c=this.pattern.length;if(c>W){let e=0;const t=c%W,i=c-t;while(e<i)d(this.pattern.substr(e,W),e),e+=W;if(t){const e=c-W;d(this.pattern.substr(e),e)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:i,includeMatches:s}=this.options;if(e=t?e:e.toLowerCase(),e=i?Y(e):e,this.pattern===e){let t={isMatch:!0,score:0};return s&&(t.indices=[[0,e.length-1]]),t}const{location:a,distance:n,threshold:o,findAllMatches:r,minMatchCharLength:l,ignoreLocation:u}=this.options;let d=[],c=0,m=!1;this.chunks.forEach((({pattern:t,alphabet:i,startIndex:h})=>{const{isMatch:p,score:g,indices:f}=$(e,t,i,{location:a+h,distance:n,threshold:o,findAllMatches:r,minMatchCharLength:l,includeMatches:s,ignoreLocation:u});p&&(m=!0),c+=g,p&&f&&(d=[...d,...f])}));let h={isMatch:m,score:m?c/this.chunks.length:1};return m&&s&&(h.indices=d),h}}class V{constructor(e){this.pattern=e}static isMultiMatch(e){return q(e,this.multiRegex)}static isSingleMatch(e){return q(e,this.singleRegex)}search(){}}function q(e,t){const i=e.match(t);return i?i[1]:null}class j extends V{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class z extends V{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=e.indexOf(this.pattern),i=-1===t;return{isMatch:i,score:i?0:1,indices:[0,e.length-1]}}}class K extends V{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Z extends V{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class X extends V{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class J extends V{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}class Q extends V{constructor(e,{location:t=O.location,threshold:i=O.threshold,distance:s=O.distance,includeMatches:a=O.includeMatches,findAllMatches:n=O.findAllMatches,minMatchCharLength:o=O.minMatchCharLength,isCaseSensitive:r=O.isCaseSensitive,ignoreDiacritics:l=O.ignoreDiacritics,ignoreLocation:u=O.ignoreLocation}={}){super(e),this._bitapSearch=new G(e,{location:t,threshold:i,distance:s,includeMatches:a,findAllMatches:n,minMatchCharLength:o,isCaseSensitive:r,ignoreDiacritics:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class ee extends V{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,i=0;const s=[],a=this.pattern.length;while((t=e.indexOf(this.pattern,i))>-1)i=t+a,s.push([t,i-1]);const n=!!s.length;return{isMatch:n,score:n?0:1,indices:s}}}const te=[j,ee,K,Z,J,X,z,Q],ie=te.length,se=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,ae="|";function ne(e,t={}){return e.split(ae).map((e=>{let i=e.trim().split(se).filter((e=>e&&!!e.trim())),s=[];for(let a=0,n=i.length;a<n;a+=1){const e=i[a];let n=!1,o=-1;while(!n&&++o<ie){const i=te[o];let a=i.isMultiMatch(e);a&&(s.push(new i(a,t)),n=!0)}if(!n){o=-1;while(++o<ie){const i=te[o];let a=i.isSingleMatch(e);if(a){s.push(new i(a,t));break}}}}return s}))}const oe=new Set([Q.type,ee.type]);class re{constructor(e,{isCaseSensitive:t=O.isCaseSensitive,ignoreDiacritics:i=O.ignoreDiacritics,includeMatches:s=O.includeMatches,minMatchCharLength:a=O.minMatchCharLength,ignoreLocation:n=O.ignoreLocation,findAllMatches:o=O.findAllMatches,location:r=O.location,threshold:l=O.threshold,distance:u=O.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:i,includeMatches:s,minMatchCharLength:a,findAllMatches:o,ignoreLocation:n,location:r,threshold:l,distance:u},e=t?e:e.toLowerCase(),e=i?Y(e):e,this.pattern=e,this.query=ne(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:s,ignoreDiacritics:a}=this.options;e=s?e:e.toLowerCase(),e=a?Y(e):e;let n=0,o=[],r=0;for(let l=0,u=t.length;l<u;l+=1){const s=t[l];o.length=0,n=0;for(let t=0,a=s.length;t<a;t+=1){const a=s[t],{isMatch:l,indices:u,score:d}=a.search(e);if(!l){r=0,n=0,o.length=0;break}if(n+=1,r+=d,i){const e=a.constructor.type;oe.has(e)?o=[...o,...u]:o.push(u)}}if(n){let e={isMatch:!0,score:r/n};return i&&(e.indices=o),e}}return{isMatch:!1,score:1}}}const le=[];function ue(...e){le.push(...e)}function de(e,t){for(let i=0,s=le.length;i<s;i+=1){let s=le[i];if(s.condition(e,t))return new s(e,t)}return new G(e,t)}const ce={AND:"$and",OR:"$or"},me={PATH:"$path",PATTERN:"$val"},he=e=>!(!e[ce.AND]&&!e[ce.OR]),pe=e=>!!e[me.PATH],ge=e=>!n(e)&&m(e)&&!he(e),fe=e=>({[ce.AND]:Object.keys(e).map((t=>({[t]:e[t]})))});function ve(e,t,{auto:i=!0}={}){const s=e=>{let a=Object.keys(e);const o=pe(e);if(!o&&a.length>1&&!he(e))return s(fe(e));if(ge(e)){const s=o?e[me.PATH]:a[0],n=o?e[me.PATTERN]:e[s];if(!u(n))throw new Error(_(s));const r={keyId:y(s),pattern:n};return i&&(r.searcher=de(n,t)),r}let r={children:[],operator:a[0]};return a.forEach((t=>{const i=e[t];n(i)&&i.forEach((e=>{r.children.push(s(e))}))})),r};return he(e)||(e=fe(e)),s(e)}function _e(e,{ignoreFieldNorm:t=O.ignoreFieldNorm}){e.forEach((e=>{let i=1;e.matches.forEach((({key:e,norm:s,score:a})=>{const n=e?e.weight:null;i*=Math.pow(0===a&&n?Number.EPSILON:a,(n||1)*(t?1:s))})),e.score=i}))}function Te(e,t){const i=e.matches;t.matches=[],p(i)&&i.forEach((e=>{if(!p(e.indices)||!e.indices.length)return;const{indices:i,value:s}=e;let a={indices:i,value:s};e.key&&(a.key=e.key.src),e.idx>-1&&(a.refIndex=e.idx),t.matches.push(a)}))}function be(e,t){t.score=e.score}function we(e,t,{includeMatches:i=O.includeMatches,includeScore:s=O.includeScore}={}){const a=[];return i&&a.push(Te),s&&a.push(be),e.map((e=>{const{idx:i}=e,s={item:t[i],refIndex:i};return a.length&&a.forEach((t=>{t(e,s)})),s}))}class Ie{constructor(e,t={},i){this.options={...O,...t},this.options.useExtendedSearch,this._keyStore=new A(this.options.keys),this.setCollection(e,i)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof B))throw new Error(v);this._myIndex=t||F(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){p(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=(()=>!1)){const t=[];for(let i=0,s=this._docs.length;i<s;i+=1){const a=this._docs[i];e(a,i)&&(this.removeAt(i),i-=1,s-=1,t.push(a))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:i,includeScore:s,shouldSort:a,sortFn:n,ignoreFieldNorm:o}=this.options;let r=u(e)?u(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return _e(r,{ignoreFieldNorm:o}),a&&r.sort(n),d(t)&&t>-1&&(r=r.slice(0,t)),we(r,this._docs,{includeMatches:i,includeScore:s})}_searchStringList(e){const t=de(e,this.options),{records:i}=this._myIndex,s=[];return i.forEach((({v:e,i,n:a})=>{if(!p(e))return;const{isMatch:n,score:o,indices:r}=t.searchIn(e);n&&s.push({item:e,idx:i,matches:[{score:o,value:e,norm:a,indices:r}]})})),s}_searchLogical(e){const t=ve(e,this.options),i=(e,t,s)=>{if(!e.children){const{keyId:i,searcher:a}=e,n=this._findMatches({key:this._keyStore.get(i),value:this._myIndex.getValueForItemAtKeyId(t,i),searcher:a});return n&&n.length?[{idx:s,item:t,matches:n}]:[]}const a=[];for(let n=0,o=e.children.length;n<o;n+=1){const o=e.children[n],r=i(o,t,s);if(r.length)a.push(...r);else if(e.operator===ce.AND)return[]}return a},s=this._myIndex.records,a={},n=[];return s.forEach((({$:e,i:s})=>{if(p(e)){let o=i(t,e,s);o.length&&(a[s]||(a[s]={idx:s,item:e,matches:[]},n.push(a[s])),o.forEach((({matches:e})=>{a[s].matches.push(...e)})))}})),n}_searchObjectList(e){const t=de(e,this.options),{keys:i,records:s}=this._myIndex,a=[];return s.forEach((({$:e,i:s})=>{if(!p(e))return;let n=[];i.forEach(((i,s)=>{n.push(...this._findMatches({key:i,value:e[s],searcher:t}))})),n.length&&a.push({idx:s,item:e,matches:n})})),a}_findMatches({key:e,value:t,searcher:i}){if(!p(t))return[];let s=[];if(n(t))t.forEach((({v:t,i:a,n})=>{if(!p(t))return;const{isMatch:o,score:r,indices:l}=i.searchIn(t);o&&s.push({score:r,key:e,value:t,idx:a,norm:n,indices:l})}));else{const{v:a,n}=t,{isMatch:o,score:r,indices:l}=i.searchIn(a);o&&s.push({score:r,key:e,value:a,norm:n,indices:l})}return s}}Ie.version="7.1.0",Ie.createIndex=F,Ie.parseIndex=U,Ie.config=O,Ie.parseQuery=ve,ue(re);var Ae=i(67476),Ce=i(94423),Ee=i(39639),ye=i(36134),De=i(89507);const Le={class:"search-icon"},Se={__name:"specialization-select",props:{modelValue:{type:String,default:""},name:{type:String,default:""},validation:{type:Array,default:()=>[]},error:{type:String,default:""}},emits:["update:modelValue","update:error","update:data"],setup(e,{expose:t,emit:i}){const{msg:n}=(0,ye.Q)(),o=e,r={id:"",text:""},l=i,u=(0,De.i)(),{specializationRefs:d}=(0,Ae.Jk)(u),c=(0,a.iH)(""),m=new Ie(d.value,{keys:["title"],useExtendedSearch:!0}),h=(0,s.Fl)((()=>d.value.map((e=>({id:e.id,text:e.title}))))),p=(0,s.Fl)((()=>{if(!c.value||!m)return h.value;const e=m.search(`'${c.value}`);return e&&0!==e.length?e.map((e=>{const{item:t}=e;return t?{id:t.id,text:t.title}:null})).filter(Boolean):[]})),g=(0,s.Fl)((()=>h.value.find((e=>e.id===o.modelValue))||r));function f(e){c.value=e}function v(e){c.value="",l("update:modelValue",e.id)}function _(){c.value=""}const T=(0,a.iH)(null);function b(){var e;null===(e=T.value)||void 0===e||e.validateOption(g.value)}return t({validate:b}),(t,i)=>((0,s.wg)(),(0,s.j4)(Ce.Z,{ref_key:"inputRef",ref:T,class:"specialization-select",clearable:!1,description:(0,a.SU)(n)("PUBLICATION_TARGET_AUDIENCE_DESCRIPTION"),error:e.error,label:(0,a.SU)(n)("PUBLICATION_TARGET_AUDIENCE_LABEL"),"max-height":160,"model-value":g.value,options:p.value,placeholder:(0,a.SU)(n)("PUBLICATION_TARGET_AUDIENCE_PlACEHOLDER"),required:"",search:g.value.text,validation:e.validation,onResetSearch:_,"onUpdate:error":i[0]||(i[0]=e=>t.$emit("update:error",e)),"onUpdate:modelValue":v,"onUpdate:search":f},{icon:(0,s.w5)((()=>[(0,s._)("div",Le,[(0,s.Wm)(Ee.Z,{id:"search",size:24})])])),_:1},8,["description","error","label","model-value","options","placeholder","search","validation"]))}};var Me=i(83744);const Pe=(0,Me.Z)(Se,[["__scopeId","data-v-1bc83c06"]]),Oe=Pe},2469:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ke});var s=i(66252),a=i(56612),n=i(58061);const o={class:"tm-publication-post__header-title"},r={key:1,class:"tm-publication-post__loading"},l={ref:"editorWrapperRef",class:"tm-publication-post__form"},u={class:"tm-publication-post__form-header"},d={key:0,class:"tm-publication-post__editor"},c={key:1,class:"tm-publication-post__preview"},m=["maxlength","placeholder"],h={class:"tm-publication-post__form-footer"},p={key:0,class:"tm-publication-post__footer-checkboxes"},g={class:"tm-publication-post__controls"};function f(e,t,i,f,v,_){const T=(0,s.up)("TMMarkdownSwitcher"),b=(0,s.up)("TMBlock"),w=(0,s.up)("TMAutosaveInfo"),I=(0,s.up)("TMFullScreenLoading"),A=(0,s.up)("TMPublicationAuthorInfo"),C=(0,s.up)("TMPostLangSwitcher"),E=(0,s.up)("TMWysiwygEditor"),y=(0,s.up)("TMArticleFormattedBody"),D=(0,s.up)("MdEditorPanel"),L=(0,s.up)("TMButtonBase"),S=(0,s.up)("SpecializationSelect"),M=(0,s.up)("TMFormBuilder"),P=(0,s.up)("TMLabeledCheckbox"),O=(0,s.up)("TMAsyncConfirmationDialog"),k=(0,s.up)("TMPublicationSidebar"),N=(0,s.up)("TMPage"),B=(0,s.Q2)("autosize");return(0,s.wg)(),(0,s.j4)(N,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,{"body-variant":"balanced",spacing:f.isMobile?"around":"bottom"},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("span",null,(0,a.zw)(_.formTitle),1),(0,s.Wm)(T,{class:"tm-publication-post__editor-control",disabled:_.isMDSwitcherDisabled,"use-markdown-editor":_.useMarkdownEditor,"use-markdown-settings-key":"useMarkdownInPosts",onChangeUseMarkdown:t[0]||(t[0]=e=>v.isRestoreForm=!1)},null,8,["disabled","use-markdown-editor"])])])),_:1},8,["spacing"]),v.savedDraft?((0,s.wg)(),(0,s.j4)(w,{key:0,"saved-date":v.savedDraft.savedDate,title:e.msg("POST_SAVED_DRAFT"),onRestoreDraft:_.restoreDraft},null,8,["saved-date","title","onRestoreDraft"])):(0,s.kq)("",!0),v.isLoading?((0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(I,{"fixed-layout":v.postIsSaving},null,8,["fixed-layout"])])):((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[(0,s._)("div",l,[(0,s._)("div",u,[(0,s.Wm)(A,{publication:f.post,"user-data":v.userData},null,8,["publication","user-data"]),(0,s.Wm)(C,{lang:_.lang,onChangeLang:_.changeLang},null,8,["lang","onChangeLang"])]),(0,s._)("div",{class:(0,a.C_)(_.postFieldClass)},[_.useMarkdownEditor?v.postPreview?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(y,{"article-text":v.postPreview,"disable-abbr":"",version:v.postPreviewVersion},null,8,["article-text","version"])])):(0,s.wy)(((0,s.wg)(),(0,s.iD)("textarea",{key:2,ref:"markdownTextAreaRef","onUpdate:modelValue":t[1]||(t[1]=e=>f.markdownSource=e),class:"tm-publication-post__textarea","data-test-id":"post-form-textarea",maxlength:e.$options.CHARS_MARKDOWN_LIMIT,placeholder:e.msg("EDITOR_MARKDOWN_BODY_PLACEHOLDER"),rows:"5",onInput:t[2]||(t[2]=(...e)=>_.onMarkdownUpdate&&_.onMarkdownUpdate(...e)),onKeydownCapture:[t[3]||(t[3]=(0,n.D2)((0,n.iM)(((...e)=>_.confirmAndProceedForm&&_.confirmAndProceedForm(...e)),["ctrl","stop"]),["enter"])),t[4]||(t[4]=(0,n.D2)((0,n.iM)(((...e)=>_.confirmAndProceedForm&&_.confirmAndProceedForm(...e)),["meta","stop"]),["enter"]))]},null,40,m)),[[n.nr,f.markdownSource],[B]]):((0,s.wg)(),(0,s.iD)("div",d,[v.renderEditor?((0,s.wg)(),(0,s.j4)(E,{key:0,ref:"editor","data-test-id":"post-form-wysiwyg","is-desktop-touch":!f.isMobile&&_.isTouchDevice,"is-mobile":f.isMobile||_.isTouchDevice,"is-mobile-only":e.isMobileOnly,lang:f.langOptions.hl,"props-config":v.WYSIWYGInitialProps,"use-test-ids":_.useTestIds,validation:v.validation,onLoading:_.setFormLoading,onTypographApplied:_.onTypographApplied,onUpdate:_.onWYSIWYGUpdate},null,8,["is-desktop-touch","is-mobile","is-mobile-only","lang","props-config","use-test-ids","validation","onLoading","onTypographApplied","onUpdate"])):(0,s.kq)("",!0)]))],2),_.useMarkdownEditor&&!v.postPreview?((0,s.wg)(),(0,s.j4)(D,{key:0,ref:"markdownPanelRef",buttons:f.POST_BUTTONS,class:"tm-publication-post__panel","subpanel-container":f.editorWrapperRef,onCommand:f.executeMarkdownCommand},null,8,["buttons","subpanel-container","onCommand"])):(0,s.kq)("",!0),(0,s._)("div",h,[_.useMarkdownEditor?((0,s.wg)(),(0,s.j4)(L,{key:0,class:"tm-publication-post__button",disabled:_.disableFormButtons,"style-size":"small","style-type":"transparent",type:"button",onClick:_.togglePreview},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(v.postPreview?e.msg("FORMS_EDIT_BUTTON_TEXT"):e.msg("FORMS_PREVIEW_BUTTON_TEXT")),1)])),_:1},8,["disabled","onClick"])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,a.C_)(_.bem("tm-publication-post__count",{warning:_.charsLeft<=0}))},(0,a.zw)(_.charsText),3)])],512),(0,s.Wm)(b,{"body-variant":"balanced"},{default:(0,s.w5)((()=>[(0,s.Wm)(M,{ref:"publicationFormRef",class:"tm-publication-post__form-additional",fields:v.formFields,"form-name":"publicationForm","initial-data":v.formData,lang:f.langOptions.hl,"server-errors":f.serverErrors,"use-test-id":_.useTestIds,"validate-on-blur":"","onUpdate:data":_.onFormUpdateData,"onUpdate:tempData":_.onFormUpdateTempData},{flow:(0,s.w5)((()=>[(0,s.Wm)(S,{ref:"specializationSelectRef",modelValue:v.formData.flow,"onUpdate:modelValue":t[5]||(t[5]=e=>v.formData.flow=e),error:f.flowError,"onUpdate:error":t[6]||(t[6]=e=>f.flowError=e),name:"flow",required:"",validation:f.flowValidation},null,8,["modelValue","error","validation"])])),_:1},8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data","onUpdate:tempData"])])),_:1}),(0,s.Wm)(b,{"body-variant":"balanced"},{default:(0,s.w5)((()=>["drafted"===v.currentStatus?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(_.bem("tm-publication-post__scheduling",{planned:v.formData.isPlanned}))},[(0,s.Wm)(M,{fields:_.schedulingFormFields,"form-name":"schedulingForm","initial-data":v.formData,lang:f.langOptions.hl,"server-errors":f.serverErrors,"use-test-id":_.useTestIds,"validate-on-blur":"","onUpdate:data":_.onFormUpdateData,"onUpdate:tempData":_.onFormUpdateTempData},null,8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data","onUpdate:tempData"])],2)):(0,s.kq)("",!0),(0,s._)("div",{class:(0,a.C_)(_.bem("tm-publication-post__footer",{drafted:"drafted"===v.currentStatus}))},[_.showModeratorControls?((0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(P,{modelValue:v.isLocked,"onUpdate:modelValue":t[7]||(t[7]=e=>v.isLocked=e),"data-test-id":"post-disable-editing-checkbox",name:"isDisabledEditing"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_LOCKED")),1)])),_:1},8,["modelValue"]),(0,s.Wm)(P,{modelValue:v.isModerated,"onUpdate:modelValue":t[8]||(t[8]=e=>v.isModerated=e),"data-test-id":"post-moderator-check-checkbox",name:"isModerated"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_MODERATED")),1)])),_:1},8,["modelValue"]),_.showIsCompanyExperience?((0,s.wg)(),(0,s.j4)(P,{key:0,modelValue:v.isCompanyExperience,"onUpdate:modelValue":t[9]||(t[9]=e=>v.isCompanyExperience=e),"data-test-id":"post-company-experience-checkbox",name:"isCompanyExperience"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_COMPANY_EXPERIENCE")),1)])),_:1},8,["modelValue"])):(0,s.kq)("",!0)])):(0,s.kq)("",!0),(0,s._)("div",g,[_.showDelete&&!e.isMobileOnly?((0,s.wg)(),(0,s.j4)(L,{key:0,class:"tm-publication-post__button","data-test-id":"button-delete-post",disabled:_.disableFormButtons,"style-size":"small","style-type":"transparent",type:"button",onClick:_.confirmAndDeletePost},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("FORMS_DELETE_BUTTON_TEXT")),1)])),_:1},8,["disabled","onClick"])):(0,s.kq)("",!0),(0,s.Wm)(L,{class:"tm-publication-post__publish-button","data-test-id":"button-send-post",disabled:_.disableFormButtons,"style-size":"small",type:"button",onClick:_.confirmAndProceedForm},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg(v.formData.isPlanned?"PUBLICATION_POST_SCHEDULE":"PUBLICATION_PUBLISH")),1)])),_:1},8,["disabled","onClick"]),(0,s.Wm)(L,{class:"tm-publication__button tm-publication__button_grey","data-test-id":"publication_save_draft",disabled:_.disableFormButtons,"style-size":"medium","style-type":"transparent",type:"button",onClick:t[10]||(t[10]=e=>_.proceedForm({isDraft:!0}))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_SAVE_DRAFT")),1)])),_:1},8,["disabled"]),_.showDelete&&e.isMobileOnly?((0,s.wg)(),(0,s.j4)(L,{key:1,class:"tm-publication-post__button","data-test-id":"button-delete-post",disabled:_.disableFormButtons,"style-size":"small","style-type":"transparent",type:"button",onClick:_.confirmAndDeletePost},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("FORMS_DELETE_BUTTON_TEXT")),1)])),_:1},8,["disabled","onClick"])):(0,s.kq)("",!0)])],2)])),_:1})],64)),((0,s.wg)(),(0,s.j4)(s.lR,{to:"#overlays"},[(0,s.Wm)(O,{ref:"confirmDialog"},null,512)]))])),sidebar:(0,s.w5)((()=>[(0,s.Wm)(k)])),_:1})}var v=i(62931),_=i(22201),T=i(91296),b=i.n(T),w=i(67476),I=i(85760),A=i(21381),C=i(7452),E=i(70352),y=i(91270),D=i(88533),L=i(34059),S=i(89734),M=i(92714),P=i(2648),O=i(56104);const k={class:"tm-post-lang-switcher"},N={class:"tm-post-lang-switcher-popup"},B={class:"tm-post-lang-switcher-popup__radio-group"};function F(e,t,i,n,o,r){const l=(0,s.up)("TMInputRadioLabeled"),u=(0,s.up)("TMButtonBase"),d=(0,s.up)("TMPopup");return(0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("button",{class:"tm-post-lang-switcher__control",onClick:t[0]||(t[0]=e=>o.showPopup=!0)},(0,a.zw)(r.languageTitle),1),o.showPopup?((0,s.wg)(),(0,s.j4)(d,{key:0,title:e.msg("POST_LANGUAGE_TITLE"),onClose:t[3]||(t[3]=e=>o.showPopup=!1)},{body:(0,s.w5)((()=>[(0,s._)("div",N,[(0,s._)("div",B,[(0,s.Wm)(l,{modelValue:o.newLang,"onUpdate:modelValue":t[1]||(t[1]=e=>o.newLang=e),"checked-value":"ru",name:"lang",value:"ru"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_LANG_RU")),1)])),_:1},8,["modelValue"]),(0,s.Wm)(l,{modelValue:o.newLang,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newLang=e),"checked-value":"en",name:"lang",value:"en"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_LANG_EN")),1)])),_:1},8,["modelValue"])]),(0,s.Wm)(u,{class:"tm-post-lang-switcher-popup__save","style-size":"small","style-type":"solid",type:"submit",onClick:r.changeLang},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("FORMS_SAVE_SETTINGS_TEXT")),1)])),_:1},8,["onClick"])])])),_:1},8,["title"])):(0,s.kq)("",!0)])}var U=i(31655),x=i(61897),R=i(25109);const W={name:"TMPostLangSwitcher",components:{TMPopup:x.Z,TMInputRadioLabeled:U.Z,TMButtonBase:y.Z},props:{lang:{type:String,required:!0,validator(e){return["ru","en"].includes(e)}}},emits:["changeLang"],data(){return{showPopup:!1,newLang:this.lang}},computed:{languageTitle(){return"ru"===this.lang?"Ру":"En"}},watch:{lang(){this.newLang=this.lang}},methods:{bem:R.P,changeLang(){this.$emit("changeLang",this.newLang),this.showPopup=!1}}};var $=i(83744);const H=(0,$.Z)(W,[["render",F]]),Y=H,G={class:"tm-publication-author-info__datetime"},V=["textContent"];function q(e,t,i,n,o,r){const l=(0,s.up)("TMArticleDatetimePublished"),u=(0,s.up)("TMUserInfo");return(0,s.wg)(),(0,s.j4)(u,{author:i.userData,avatar:i.userData.image,"avatar-size":32,class:"tm-publication-author-info","login-appearance":"post","resize-image":!1},{default:(0,s.w5)((()=>[(0,s._)("div",G,[i.publication?((0,s.wg)(),(0,s.j4)(l,{key:0,article:i.publication,"is-megapost-v1":!1},null,8,["article"])):((0,s.wg)(),(0,s.iD)("span",{key:1,"data-test-id":"articleNeverPublishedMessage",textContent:(0,a.zw)(e.msg("ARTICLE_NEVER_PUBLISHED"))},null,8,V))])])),_:1},8,["author","avatar"])}var j=i(6222),z=i(65904);const K={name:"TMPublicationAuthorInfo",components:{TMUserInfo:z.Z,TMArticleDatetimePublished:j.Z},props:{userData:{type:Object,required:!0},publication:{type:Object,default:null}}},Z=(0,$.Z)(K,[["render",q]]),X=Z;var J=i(28485),Q=i(40653),ee=i(78052),te=i(80271),ie=i(21805),se=i(36134),ae=i(86598);const ne=1,oe=2,re=4;function le({msg:e,hubsSuggest:t}){return[{name:"flow",type:"CustomField",position:{row:"1",column:"1 / 7"},validation:{required:!0}},{className:"tm-chips",label:e("PUBLICATION_HUBS"),htmlAttrs:{placeholder:e("PUBLICATION_HUBS_PLACEHOLDER")},description:e("POST_HUBS_HINT"),name:"hubs",type:"BaseChips",suggest:t,validation:{required:!0,minLength:1,maxLength:5},position:{row:"3",column:"1 / 7"}},{className:"tm-hub-notice",name:"notice",text:e("PUBLICATION_HUBS_NOTICE"),type:"BaseNotice",variant:"warning",validation:{},position:{row:"4",column:"1 / 7"},displayConditions:[{fieldName:"hubs",values:[{alias:"465"},{alias:"19259"}]}]},{className:"tm-hub-notice",name:"notice",type:"BaseNotice",variant:"warning",validation:{},position:{row:"5",column:"1 / 7"},displayConditions:[{fieldName:"hubs",values:[]}]},{className:"tm-chips-outline",label:e("PUBLICATION_KEYWORDS"),htmlAttrs:{placeholder:e("PUBLICATION_KEYWORDS")},description:e("PUBLICATION_KEYWORDS_HINT"),name:"tags",type:"BaseChips",allowCustomValue:!0,extraSeparator:",",suggest:[],validation:{required:!0,minLength:1,maxLength:10},position:{row:"6",column:"1 / 7"}}]}function ue({msg:e}){return[{className:"tm-checkbox",name:"isPlanned",type:"BaseCheckbox",label:e("PLAN_PUBLICATION"),defaultValue:!1,validation:{required:!1},position:{row:"1",column:"auto / auto"},breakpoint:{1024:{position:{row:"1",column:"1 / 2"}}}},{className:"tm-datetime",name:"plannedDateTime",type:"BaseDatetime",withTime:!0,disabledBefore:new Date,defaultValue:ae.Ro.toISOString(),position:{row:"2",column:"1 / 7"},breakpoint:{1024:{position:{row:"1",column:"3 / 6"}}},validation:{required:!0},displayConditions:[{fieldName:"isPlanned",values:[!0]}]}]}var de=i(58748),ce=i(84183),me=i(71197),he=i(89507),pe=i(62524),ge=i(68323),fe=i(1714),ve=i(85725),_e=i(13862),Te=i(52767),be=i(80546),we=i(48070),Ie=i(67426),Ae=i(10707),Ce=i(57733),Ee=i(32790),ye=i(87032);const De=4e3,Le=4100,Se="habr-wysiwyg-m-posts",Me=3,Pe={name:"TMPublicationPost",components:{MdEditorPanel:P.Z,TMPublicationAuthorInfo:X,TMBlock:E.Z,TMPage:O.Z,TMArticleFormattedBody:I.Z,TMButtonBase:y.Z,TMPostLangSwitcher:Y,TMAsyncConfirmationDialog:A.Z,TMMarkdownSwitcher:M.Z,TMAutosaveInfo:C.Z,TMFormBuilder:D.Z,TMLabeledCheckbox:S.Z,TMPublicationSidebar:J.Z,TMFullScreenLoading:L.Z,TMWysiwygEditor:ee.Z,SpecializationSelect:Q.Z},directives:{autosize:fe.e},CHARS_MARKDOWN_LIMIT:Le,setup(){const e=(0,_.yj)(),t=(0,de.g)(),i=(0,he.i)(),{langOptions:a}=(0,se.Q)(),n=(0,ce.s)(),{isDesktop:o,isMobile:r}=(0,w.Jk)(n),l=(0,me.q)(),{user:u,isSuperAdmin:d,isModerator:c,useMarkdownInPosts:m,isReadOnlyOrCommentsManual:h}=(0,w.Jk)(l),p=(0,s.Fl)((()=>e.params.publicationId)),g=(0,s.Fl)((()=>t.getArticleById(p.value)));(0,ie.w)((()=>{const s=[];return s.push(i.loadSpecializationRefs(p.value)),"PUBLICATION_POST_EDIT"!==e.name||g.value||s.push(t.loadArticle(p.value,!0)),Promise.all(s)}));const f=(0,v.iH)(null),T=(0,v.iH)(null),{markdownText:b,executeCommand:I}=(0,te.A)(f,{initialText:"",handlers:{tab(){var e;null===(e=T.value)||void 0===e||e.focus()}}});function A(e){I(e)}const C=(0,v.iH)(null),{msg:E}=(0,se.Q)(),y=(0,v.iH)(null),D=[e=>e&&e.id?"":E("PUBLICATION_TARGET_AUDIENCE_PlACEHOLDER")],L=(0,v.iH)("");return(0,s.YP)(y,(()=>{y.value.flow&&(L.value=y.value.flow)}),{deep:!0}),{id:p,post:g,markdownSource:b,markdownTextAreaRef:f,markdownPanelRef:T,executeMarkdownCommand:A,editorWrapperRef:C,POST_BUTTONS:be.fB,flowValidation:D,serverErrors:y,flowError:L,isDesktop:o,isMobile:r,currentUser:u,isSuperAdmin:d,isModerator:c,useMarkdownInPosts:m,isReadOnlyOrCommentsManual:h,langOptions:a}},data(){return{renderEditor:!1,WYSIWYGInitialProps:{embedHost:"https://embedd.srv.habr.com",imagesHost:(0,Ae.k)("publication/upload","v2"),mentionHost:(0,Ae.k)("publication/suggest-mention","v2"),imagesByUrlHost:(0,Ae.k)("publication/upload-url","v2"),extensions:[],initialJSON:null},validation:{required:!1,nodesLimit:{"Image|Embed":1},maxCharsLimit:De},WYSIWYGData:{},WYSIWYGLoading:!1,WYSIWYGInit:!1,postPreview:null,postPreviewVersion:null,previewLoading:!1,changedLang:null,charsCount:0,isLoading:!0,isModerated:!1,isCompanyExperience:!1,isLocked:!1,editPostUsesMarkdown:!1,isRestoreForm:!1,savedDraft:null,postIsSaving:!1,userData:{},formFields:[],formData:{},suggestHubs:[],currentStatus:"drafted"}},head(){return{title:this.formTitle}},computed:{isEditForm(){return"PUBLICATION_POST_EDIT"===this.$route.name},lang(){return this.changedLang?this.changedLang:this.langOptions&&"en"===this.langOptions.fl?"en":"ru"},useTestIds(){return!1},disableFormButtons(){return this.charsCount<10||this.postIsSaving||this.WYSIWYGLoading||this.previewLoading},showIsCompanyExperience(){return this.formData.hubs.find((e=>e.isCorporative))},isMDSwitcherDisabled(){return!this.isTextareaEmpty},useMarkdownEditor(){return this.isRestoreForm?this.editPostUsesMarkdown:this.useMarkdownInPosts},charsLeft(){const e=this.useMarkdownEditor?Le:De;return e-this.charsCount},charsText(){return this.msg("POST_CHARACTERS",{count:this.charsLeft})},isTouchDevice(){return(0,_e.b1)()},isTextareaEmpty(){if(!this.useMarkdownEditor){const e=this.WYSIWYGData.json&&this.WYSIWYGData.json.content.filter((e=>"paragraph"!==e.type)).length,t=this.WYSIWYGData.textContent||"";return!e&&!t.trim().length}return!this.markdownSource},draftKey(){return this.isEditForm?`post-${this.id}`:"post-new"},routeKey(){return(0,ve.Z)(this.$route)},showDelete(){return this.isEditForm},showModeratorControls(){return this.isEditForm&&(this.isSuperAdmin||this.isModerator)},formTitle(){return this.isEditForm?this.msg("POST_EDITING_TITLE"):this.msg("POST_CREATING_TITLE")},isSandbox(){return this.$route.meta.isSandboxPage},schedulingFormFields(){return ue({msg:this.msg})},postFieldClass(){return(0,R.P)("tm-publication-post__field",{bordered:this.useMarkdownEditor&&!this.postPreview})}},async mounted(){var e,t;this.isReadOnlyOrCommentsManual&&!this.isSandbox&&this.$router.push({...this.$route,name:this.$route.name.replace("PUBLICATION_POST","PUBLICATION_SANDBOX")});const i=(0,ge.S)();await i.getWYSIWYGRulesRefsIfNotExist(),this.WYSIWYGInitialProps.extensions=null===(e=i.WYSIWYGRulesRefs)||void 0===e||null===(t=e.thread)||void 0===t?void 0:t.elements,this.WYSIWYGInitialProps.extensions.push("Typograph"),this.savedDraft=(0,ae.fp)(Se,this.draftKey),this.suggestHubs=await(0,Ee.aW)({postType:"simple",post:this.id?this.id:null,postContext:"post"}),this.formFields=le({msg:this.msg,hubsSuggest:this.suggestHubs.map((e=>({...e,name:this.msg(e.name)}))),hubs:this.formData.hubs}),this.isEditForm?this.setEditedPost():(this.renderEditor=!0,this.isLoading=!1,this.userData={avatarUrl:this.currentUser.image||this.currentUser.avatarUrl,login:this.currentUser.alias,alias:this.currentUser.alias}),window.addEventListener("beforeunload",this.handlePageLeave)},beforeUnmount(){window.removeEventListener("beforeunload",this.handlePageLeave)},methods:{bem:R.P,changeLang(e){this.changedLang=e},onWYSIWYGUpdate(e){this.charsCount=e.charsCount||0,this.WYSIWYGData=e,0!==this.charsCount&&this.WYSIWYGInit?this.debouncedLocalStorageSave():this.WYSIWYGInit=!0},onTypographApplied(){this.$toast.success(this.msg("PUBLICATION_TYPOGRAPH_APPLIED"))},onMarkdownUpdate(){this.charsCount=this.markdownSource.length,this.debouncedLocalStorageSave()},setFormLoading(e){this.WYSIWYGLoading=e},handlePageLeave(e){if(!this.isTextareaEmpty)return e.preventDefault(),e.returnValue="",!0},loadPreview(){this.previewLoading=!0,(0,Ce.s1)({text:this.buildFormData({isDraft:!1}).text}).then((e=>{this.postPreview=`<div>${e.textHtml}</div>`,this.postPreviewVersion=e.editorVersion})).catch((e=>{const t=e.data&&e.data.text&&e.data.text.source&&Array.isArray(e.data.text.source);t?this.$toast.error(e.data.text.source[0]):this.$toast.error(e.message)})).finally((()=>{this.previewLoading=!1}))},togglePreview(){this.postPreview?(this.postPreview=null,this.postPreviewVersion=null,this.$nextTick((()=>{this.$refs.textarea&&this.$refs.textarea.focus()}))):this.loadPreview()},deletePost(){(0,Ce.fR)(this.id).then((()=>{(0,de.g)().removePost(this.id,this.routeKey),this.$router.push({name:"POSTS_ALL",params:{hl:this.langOptions.hl}})})).catch((e=>{this.$toast.error(e.message)}))},async validateFormsAndShowErrors(){var e,t;null===(e=this.$refs.publicationFormRef)||void 0===e||e.validateForm(),null===(t=this.$refs.specializationSelectRef)||void 0===t||t.validate(),await this.$nextTick();const i=(0,Ie.Ab)();return i},async proceedForm({isDraft:e}){await this.validateFormsAndShowErrors()||this.isTextareaEmpty||(this.$refs.editor&&await this.$refs.editor.awaitPendingOperations(),this.postPreview=null,this.postPreviewVersion=null,this.postIsSaving=!0,this.showIsCompanyExperience||(this.isCompanyExperience=!1),(0,Ce.W1)(this.buildFormData({isDraft:e}),this.id).then((e=>{const t=e.thread;(0,de.g)().setPost(t.id,t,this.routeKey),this.reset();const i=this.formData.hubs[0];i.isCorporative?this.$router.push({name:we.VU.POST_OF_COMPANY,params:{companyName:i.aliasName,id:t.id}}):this.$router.push({name:we.VU.POST,params:{hubName:i.aliasName,id:t.id}})})).catch((e=>{var t,i;const s=null===(t=e.data)||void 0===t||null===(i=t.text)||void 0===i?void 0:i.source;s&&Array.isArray(s)&&this.$toast.error(s[0]);const a=(0,ye.getErrorCode)(e);"HUB_KARMA_RESTRICTION"===a&&this.showHubKarmaRestriction(e.data);const n=(0,Te.TU)(e);if(n)return this.serverErrors=(0,ae.RC)(n),void this.$nextTick(Ie.Ab);a&&this.$toast.error((null===e||void 0===e?void 0:e.message)??this.msg("ERROR_PAGE_MESSAGE_INTERNAL"))})).finally((()=>{this.postIsSaving=!1})))},getNewPostStatus({isDraft:e,isPlanned:t}){return t||e?"drafted":"published"},buildFormData({isDraft:e}){return{status:this.getNewPostStatus({isDraft:e,isPlanned:this.formData.isPlanned}),lang:this.lang,hubs:this.formData.hubs?this.formData.hubs.map((e=>e.id)):[],tags:this.formData.tags?this.formData.tags.map((e=>e.name)):[],text:{source:this.useMarkdownEditor?this.markdownSource:JSON.stringify(this.WYSIWYGData.json),editorVersion:2,isMarkdown:this.useMarkdownEditor},isLocked:this.isLocked,isModerated:this.isModerated,isCompanyExperience:this.isCompanyExperience,isPlanned:this.formData.isPlanned,plannedDateTime:this.formData.plannedDateTime,flow:this.formData.flow||null}},reset(){this.renderEditor=!1,this.markdownSource=null,this.WYSIWYGInitialProps.initialJSON=null,this.clearFromLocalStorage(),this.$nextTick((()=>{this.renderEditor=!0}))},confirmAndProceedForm(e){const t=this.formData.isPlanned?this.msg("PUBLICATION_POST_SCHEDULE_CONFIRM"):this.msg("POST_PUBLISH_ACTION_ALERT");this.$refs.confirmDialog.show({title:t,confirmLabel:this.msg("NAV_OK"),cancelLabel:this.msg("NAV_CANCEL")}).then((t=>{t&&this.proceedForm({isDraft:e})}))},confirmAndDeletePost(){this.$refs.confirmDialog.show({title:this.msg("POST_DELETION_TEXT"),confirmLabel:this.msg("NAV_OK"),cancelLabel:this.msg("NAV_CANCEL")}).then((e=>{e&&this.deletePost()}))},debouncedLocalStorageSave:b()((function(){if(this.isTextareaEmpty)return;const e={author:this.userData,postForm:this.buildFormData({isDraft:!0}),savedDate:new Date};(0,ae.cv)(e,"post-new",this.draftKey,Se,Me),this.savedDraft=null}),3e3),clearFromLocalStorage(){(0,ae.dV)(Se,this.draftKey),this.savedDraft=null},restoreDraft(){const e=window.confirm(this.msg("PUBLICATION_RESTORE_ACTION_ALERT"));if(e){const{postForm:e}=this.savedDraft;this.savedDraft=null,this.setPostData(e)}},setEditedPost(){(0,Ce.k3)(this.id).then((e=>{const t=e.threadForm;this.changedLang=t.lang,this.currentStatus=t.status,this.userData={avatarUrl:e.author.avatarUrl,login:e.author.alias,alias:e.author.alias},this.setPostData(t),this.isLoading=!1})).catch((e=>{const t=(0,ye.getHttpCode)(e),i={message:e.message||e,errorCode:(0,ye.getErrorCode)(e)};t&&(i.httpCode=t),(0,pe.E)().showError(i)}))},setPostData(e){this.isRestoreForm=!0,this.isLocked=e.isLocked,this.isModerated=e.isModerated,this.isCompanyExperience=e.isCompanyExperience,this.formData.hubs=this.getSelectedHubs(e.hubs),this.formData.tags=e.tags.map((e=>({name:e}))),this.editPostUsesMarkdown=e.text.isMarkdown,this.formData.isPlanned=e.isPlanned,this.formData.plannedDateTime=e.plannedDateTime,this.formData.flow=e.flow||null,this.editPostUsesMarkdown?(this.markdownSource=e.text.source,this.charsCount=this.markdownSource.length):(this.renderEditor=!1,this.WYSIWYGInitialProps.initialJSON=e.text.source,this.$nextTick((()=>{this.renderEditor=!0})))},getSelectedHubs(e){const t=[];return this.suggestHubs.forEach((i=>{i.list.forEach((i=>{const s=e.includes(i.id);s&&t.push(i)}))})),t},onFormUpdateTempData(e){e.tags?this.debouncedFetchSuggestTags(e.tags,re):this.formFields[re].suggest=[]},onFormUpdateData(e){const t={...e};if(e.hubs){this.checkPostLimitNotice(e.hubs);const i=t.hubs.filter((e=>e.isCorporative));i.length>1&&(t.hubs=t.hubs.filter((e=>e.id!==i[0].id))),e.hubs.forEach((i=>{"465"===i.id&&e.hubs.length>1&&(t.hubs=[i],this.$toast.warning(this.msg("PUBLICATION_HUBS_SELF_PROMO_ONLY")))}))}e.isPlanned!==this.formData.isPlanned&&(t.plannedDateTime=ae.Ro.toISOString()),this.$nextTick((()=>{this.formData=t})),this.debouncedLocalStorageSave()},checkPostLimitNotice(e){const t=[],i=[],s=this.post&&this.post.timePublished,a=this.isEditForm?this.formFields[ne].suggest[0].list:[];e.forEach((e=>{const n=a.find((({id:t})=>t===e.id));if(!Number.isInteger(e.postsLeft)||s&&n||(t.push((0,ae.fM)(e,this.msg)),i.push({id:e.id})),t.length){const e=`<p>${t.join("</p><p>")}</p>`;this.formFields[oe].text=e,this.formFields[oe].displayConditions=[{fieldName:"hubs",values:i}]}}))},debouncedFetchSuggestTags:b()((function(e,t){return(0,Ee.mj)({q:e}).then((({tags:e})=>{e.length?this.formFields[t].suggest=[{name:this.msg("PUBLICATION_KEYWORDS"),list:e}]:this.formFields[t].suggest=[]}))}),300),showHubKarmaRestriction({minLimit:e,hubAlias:t}){const i=this.formData.hubs.find((e=>e.aliasName===t)),s=this.$router.resolve({name:"HUB_PAGE",params:{hubName:i.aliasName,hl:this.langOptions.hl}}),a=[];a.push({id:i.id}),this.formFields[oe].text=this.msg("PUBLICATION_HUBS_KARMA_RESTRICTION",{link:s.href,minLimit:e,hubTitle:i.name.replace(" *","")}),this.formFields[oe].displayConditions=[{fieldName:"hubs",values:a}]}}},Oe=(0,$.Z)(Pe,[["render",f]]),ke=Oe},45187:(e,t,i)=>{i.r(t),i.d(t,{default:()=>vt});var s=i(66252),a=i(56612),n=i(58061);const o={class:"tm-editor__header-title"},r={class:"tm-editor__header"},l={class:"tm-publication__user"},u={class:"tm-publication__datetime"},d=["textContent"],c={class:"tm-editor__bottom-inner"},m={class:"tm-publication__submit-container","data-test-id":"publication-submit-container"},h={class:"tm-publication__checks"},p={key:0,class:"tm-publication__moderation-form"},g={key:1,class:"tm-publication__corrector-form"},f={class:"tm-publication__stats-notice"},v={class:"tm-publication__buttons"},_={class:"tm-publication__submit-right"};function T(e,t,i,T,b,w){const I=(0,s.up)("TMMarkdownSwitcher"),A=(0,s.up)("TMBlock"),C=(0,s.up)("TMAutosaveInfo"),E=(0,s.up)("TMFormBuilder"),y=(0,s.up)("TMEmptyPlaceholder"),D=(0,s.up)("TMFullScreenLoading"),L=(0,s.up)("TMUserInfo"),S=(0,s.up)("TMDatetime"),M=(0,s.up)("TMWysiwygEditor"),P=(0,s.up)("MarkdownEditor"),O=(0,s.up)("MarkdownEditorPanel"),k=(0,s.up)("TMButtonBase"),N=(0,s.up)("TMAsyncConfirmationDialog"),B=(0,s.up)("SpecializationSelect"),F=(0,s.up)("TMPublicationPolls"),U=(0,s.up)("TMSuggestBanners"),x=(0,s.up)("TMSuggestMultiwidgets"),R=(0,s.up)("TMUserNotice"),W=(0,s.up)("TMPublicationSidebar"),$=(0,s.up)("TMPage");return(0,s.wg)(),(0,s.j4)($,null,(0,s.Nv)({default:(0,s.w5)((()=>[e.isMegapost||1!==e.step?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(A,{key:0,"body-variant":"balanced",spacing:e.isMobile?"around":"bottom"},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s._)("span",null,(0,a.zw)(e.formTitle),1),e.isMegapost?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(I,{key:0,class:"tm-editor__switcher",disabled:e.isMDSwitcherDisabled,"use-markdown-editor":e.useMarkdownEditor,"use-markdown-settings-key":"useMarkdownInArticles",onChangeUseMarkdown:t[0]||(t[0]=t=>e.isRestoreForm=!1)},null,8,["disabled","use-markdown-editor"]))])])),_:1},8,["spacing"])),e.savedDraft?((0,s.wg)(),(0,s.j4)(C,{key:1,"saved-date":e.savedDraft.savedDate,title:e.msg("PUBLICATION_SAVED_DRAFT",{title:e.getDraftTitle(e.savedDraft.postForm.title)}),onRestoreDraft:e.restoreDraft},null,8,["saved-date","title","onRestoreDraft"])):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",r,[(0,s.Wm)(E,{ref:"megapostHeaderFormRef",fields:e.megapostHeaderFormFields,"form-name":"megapostHeader","initial-data":e.megapostHeaderFormData,lang:e.langOptions.hl,"server-errors":e.serverErrors,"use-test-id":e.useTestIds,"validate-on-blur":"","onUpdate:data":e.onMegapostHeaderFormUpdateData,"onUpdate:tempData":e.onMegapostHeaderFormUpdateTempData},null,8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data","onUpdate:tempData"])],512),[[n.F8,!e.isLoading&&e.isMegapost&&1===e.step]]),(0,s._)("div",{class:(0,a.C_)(["tm-editor__wrapper",{"tm-editor__wrapper_megapost":e.isMegapost,"tm-editor__wrapper_markdown":e.useMarkdownEditor}])},[e.showSandboxWarning?((0,s.wg)(),(0,s.j4)(y,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_SANDBOX_ALREADY_SENT")),1)])),_:1})):e.showFullScreenLoading?((0,s.wg)(),(0,s.j4)(D,{key:1,"fixed-layout":e.isSaving},null,8,["fixed-layout"])):(0,s.kq)("",!0),e.isLoading?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[(0,s.wy)((0,s._)("div",{class:(0,a.C_)(e.bem("tm-editor__step-1",{transparent:!e.WYSIWYGIsMounted&&!e.useMarkdownEditor}))},[(0,s._)("div",l,[(0,s.Wm)(L,{author:e.userData,avatar:e.userData.image,class:"tm-publication__username"},null,8,["author","avatar"]),(0,s._)("span",u,[e.timePublished?((0,s.wg)(),(0,s.j4)(S,{key:0,date:new Date(e.timePublished),"show-full-date-time":e.isEditForm},null,8,["date","show-full-date-time"])):((0,s.wg)(),(0,s.iD)("span",{key:1,"data-test-id":"articleNeverPublishedMessage",textContent:(0,a.zw)(e.msg("ARTICLE_NEVER_PUBLISHED"))},null,8,d))])]),e.useMarkdownEditor?((0,s.wg)(),(0,s.j4)(P,{key:1,ref:"mdEditor","disabled-navigation":e.isMarkdownNavigationDisabled,"markdown-source":e.markdownSource,"markdown-title":e.markdownTitle,"with-title":"",onFocusPanel:e.handleMdPanelFocus,onPreview:e.onMDEditorPreview,"onUpdate:data":e.onMDEditorUpdateData},null,8,["disabled-navigation","markdown-source","markdown-title","onFocusPanel","onPreview","onUpdate:data"])):((0,s.wg)(),(0,s.j4)(M,{key:0,ref:"editor",class:(0,a.C_)(["tm-editor",{"tm-editor_megapost":e.isMegapost}]),"is-desktop-touch":!e.isMobile&&e.isTouchDevice,"is-mobile":e.isMobile||e.isTouchDevice,"is-mobile-only":e.isMobileOnly,lang:e.langOptions.hl,"mobile-menu-sticky-offset":e.mobileMenuStickyOffset,"props-config":e.WYSIWYGInitialProps,"use-test-ids":e.useTestIds,onChangeMediaLoading:e.onMediaContentLoading,onTypographApplied:e.onTypographApplied,onUpdate:e.onWYSIWYGUpdate,onVnodeMounted:e.onWYSIWYGMounted},null,8,["class","is-desktop-touch","is-mobile","is-mobile-only","lang","mobile-menu-sticky-offset","props-config","use-test-ids","onChangeMediaLoading","onTypographApplied","onUpdate","onVnodeMounted"])),e.textDataLoading?((0,s.wg)(),(0,s.j4)(D,{key:2,"fixed-loader-position":""})):(0,s.kq)("",!0),(0,s._)("div",{class:(0,a.C_)(["tm-editor__bottom",{"tm-editor__bottom_megapost":e.isMegapost}])},[e.mdEditor&&!e.markdownPreviewVisible?((0,s.wg)(),(0,s.j4)(O,{key:0,ref:"mdPanel",buttons:e.PUBLICATION_BUTTONS,class:"tm-editor__panel","subpanel-container":e.mdEditor.$el,onCommand:e.executeMarkdownCommand,onReset:e.handleMdPanelBlur},null,8,["buttons","subpanel-container","onCommand","onReset"])):(0,s.kq)("",!0),(0,s._)("div",c,[(0,s.Wm)(k,{class:"tm-publication__button","data-test-id":"publication_ready_for_publish",disabled:e.disableNextStep,"style-size":"medium","style-type":"transparent",type:"button",onClick:t[1]||(t[1]=t=>e.setStep(2))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_READY_PUBLISH")),1)])),_:1},8,["disabled"]),e.useMarkdownEditor?((0,s.wg)(),(0,s.j4)(k,{key:0,class:"tm-publication__button","data-test-id":"publication_markdown_preview",disabled:e.disableNextStep,"style-size":"medium","style-type":"transparent",type:"button",onClick:t[2]||(t[2]=t=>e.markdownPreviewVisible?e.hideMarkdownPreview(t):e.showMarkdownPreview(t))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.markdownPreviewVisible?e.msg("FORMS_EDIT_BUTTON_TEXT"):e.msg("FORMS_PREVIEW_BUTTON_TEXT")),1)])),_:1},8,["disabled"])):(0,s.kq)("",!0),t[9]||(t[9]=(0,s._)("div",{class:"tm-publication__bottom-spacer"},null,-1))])],2)],2),[[n.F8,1===e.step]]),2===e.step?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(["tm-editor__step-2",{"tm-editor__step-2_megapost":e.isMegapost}])},[((0,s.wg)(),(0,s.j4)(s.lR,{to:"#overlays"},[(0,s.Wm)(N,{ref:"confirmDialog"},null,512)])),(0,s.Wm)(E,{ref:"publicationFormRef",fields:e.formFields,"form-name":"publicationForm","initial-data":e.formData,lang:e.langOptions.hl,"server-errors":e.serverErrors,"use-test-id":e.useTestIds,"validate-on-blur":"","onUpdate:data":e.onFormUpdateData,"onUpdate:tempData":e.onFormUpdateTempData},{flow:(0,s.w5)((()=>[(0,s.Wm)(B,{ref:"specializationSelectRef",modelValue:e.formData.flow,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.formData.flow=t),e.resetIdempotenceKey],error:e.flowError,"onUpdate:error":t[4]||(t[4]=t=>e.flowError=t),name:"flow",required:"",validation:e.flowValidation},null,8,["modelValue","error","validation","onUpdate:modelValue"])])),_:1},8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data","onUpdate:tempData"]),e.isMegapost||e.isSandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(F,{key:0,ref:"polls","initial-polls-data":e.getInitialPollsData(),"server-errors":e.serverErrors&&e.serverErrors.polls,"onUpdate:data":e.onPollsUpdateData,"onUpdate:error":e.onPollsUpdateErrorData},null,8,["initial-polls-data","server-errors","onUpdate:data","onUpdate:error"])),e.showSuggestBanners?((0,s.wg)(),(0,s.j4)(U,{key:1,banners:e.bannersInfo.suggestBanners,"chosen-banner":e.chosenBanner,"company-alias":e.bannersInfo.companyAlias,"has-post-banners":e.bannersInfo.hasPostBanners,lang:e.langOptions.hl,onOnBannersUpdateData:e.onBannersUpdateData},null,8,["banners","chosen-banner","company-alias","has-post-banners","lang","onOnBannersUpdateData"])):(0,s.kq)("",!0),e.corpFeatures.multiwidget.visible?((0,s.wg)(),(0,s.j4)(x,{key:2,modelValue:e.corpFeatures.multiwidget.model,"onUpdate:modelValue":t[5]||(t[5]=t=>e.corpFeatures.multiwidget.model=t),"company-alias":e.corpFeatures.multiwidget.data.companyAlias,"has-multiwidgets":e.corpFeatures.multiwidget.accessible,lang:e.langOptions.hl,multiwidgets:e.corpFeatures.multiwidget.data.multiwidgets},null,8,["modelValue","company-alias","has-multiwidgets","lang","multiwidgets"])):(0,s.kq)("",!0),(0,s._)("div",m,[(0,s._)("div",h,[e.isSuperAdmin&&!e.isMegapost?((0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(E,{fields:e.moderatorFormFields,"form-name":"moderatorCheck","initial-data":e.moderatorFormData,lang:e.langOptions.hl,"server-errors":e.serverErrors,"use-test-id":e.useTestIds,"validate-on-blur":"","onUpdate:data":e.onModeratorFormUpdateData},null,8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data"])])):(0,s.kq)("",!0),!e.isCorrector&&!e.isSuperAdmin||e.isMegapost?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",g,[(0,s.Wm)(E,{fields:e.correctorFormFields,"form-name":"correctorCheck","initial-data":e.correctorFormData,lang:e.langOptions.hl,"server-errors":e.serverErrors,"use-test-id":e.useTestIds,"validate-on-blur":"","onUpdate:data":e.onCorrectorFormUpdateData},null,8,["fields","initial-data","lang","server-errors","use-test-id","onUpdate:data"])]))]),(0,s._)("div",f,[(0,s.Wm)(R,{notice:{level:"info",isPermanent:!0,message:e.msg("STATISTICS_PUBLISH_NOTICE")}},null,8,["notice"])]),(0,s._)("div",v,[(0,s.Wm)(k,{class:"tm-publication__button tm-publication__button_grey","data-test-id":"publication_back_to_editor","style-size":"medium","style-type":"transparent",type:"button",onClick:t[6]||(t[6]=t=>e.setStep(1))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_BACK_TO_EDITOR")),1)])),_:1}),(0,s._)("div",_,[(0,s.Wm)(k,{class:"tm-publication__button tm-publication__button_green","data-test-id":"publication_publish",disabled:e.isSaving,"style-size":"medium","style-type":"solid",type:"button",onClick:t[7]||(t[7]=t=>e.confirmAndProceedForm({isDraft:!1}))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.isSandbox?e.msg("PUBLICATION_PUBLISH_SANDBOX"):e.publishButtonLabel),1)])),_:1},8,["disabled"]),e.isSandbox?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(k,{key:0,class:"tm-publication__button tm-publication__button_grey","data-test-id":"publication_save_draft",disabled:e.isSaving,"style-size":"medium","style-type":"transparent",type:"button",onClick:t[8]||(t[8]=t=>e.proceedForm({isDraft:!0}))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_SAVE_DRAFT")),1)])),_:1},8,["disabled"]))])])])],2)):(0,s.kq)("",!0)],64))],2)])),_:2},[e.isMegapost?void 0:{name:"sidebar",fn:(0,s.w5)((()=>[(0,s.Wm)(W,{"is-sandbox":e.isSandbox},null,8,["is-sandbox"])])),key:"0"}]),1024)}var b=i(62931),w=i(22201),I=i(91296),A=i.n(I),C=i(59022),E=i(67476),y=i(21381),D=i(7452),L=i(70352),S=i(91270),M=i(20666),P=i(59810),O=i(88533),k=i(34059),N=i(92714),B=i(23002),F=i(64487),U=i(85760),x=i(80271),R=i(1714),W=i(52767),$=i(32790);const H={class:"md-editor","data-test-id":"publication-md-editor"},Y=["innerHTML"],G=["placeholder"],V=["placeholder"],q=Object.assign({name:"TMMDEditor",directives:{autosize:R.e}},{__name:"md-editor",props:{markdownSource:{type:String,default:""},markdownTitle:{type:String,default:""},disabledNavigation:Boolean},emits:["update:data","preview","focus-panel"],setup(e,{expose:t,emit:i}){const a=e,o=i,r=(0,b.iH)(null),{markdownText:l,executeCommand:u,updateMarkdownSelection:d}=(0,x.A)(r,{initialText:a.markdownSource,handlers:{tab(){o("focus-panel")}}}),c=(0,b.iH)(a.markdownTitle),m=(0,b.iH)(null);function h(){o("update:data",{title:c.value,body:l.value})}function p(){c.value=c.value?c.value.replace(/\n/g,""):"",h()}(0,s.YP)(l,(()=>{h()}));const g=["ArrowDown","ArrowRight","Enter","Tab"];async function f(e){if(g.includes(e.key)){const{selectionEnd:t}=m.value;if("ArrowRight"===e.key)return void(t===m.value.length&&(e.preventDefault(),d()));if(e.preventDefault(),"Enter"===e.key)return void d();d(t)}}const v=["ArrowUp","ArrowLeft","Backspace"];function _(){var e;m.value.focus(),null===(e=m.value)||void 0===e||e.setSelectionRange(1/0,1/0)}async function T(e){if(v.includes(e.key)){var t,i;const n=null===(t=r.value)||void 0===t?void 0:t.selectionStart,o=null===(i=r.value)||void 0===i?void 0:i.selectionEnd;if("ArrowUp"===e.key&&n===o&&!a.disabledNavigation){var s;const t=null===(s=l.value)||void 0===s?void 0:s.slice(0,n),i=!t.includes("\n");if(i)return e.preventDefault(),void _()}0!==n||o!==n||a.disabledNavigation||_()}}const w=(0,B.pm)(),I=(0,b.iH)(null),A=(0,b.iH)(!1);async function C(){try{A.value=!0;const e={title:c.value,text:{editorVersion:2,source:l.value,isMarkdown:!0}};I.value=await(0,$.d7)(e),o("preview",{visible:!0})}catch(e){(0,F.Tb)(e);const t=(0,W.C5)(e,"title"),i=(0,W.C5)(e,"text");if(t||i)return void w.error(t||i);w.error(e.message)}finally{A.value=!1}}function E(){I.value=null,o("preview",{visible:!1})}function y(e){u(e),h()}return t({showPreview:C,hidePreview:E,executeCommand:y}),(e,t)=>{const i=(0,s.Q2)("autosize");return(0,s.wg)(),(0,s.iD)("div",H,[A.value?((0,s.wg)(),(0,s.j4)(k.Z,{key:0,"fixed-loader-position":""})):(0,s.kq)("",!0),I.value?((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s._)("div",{class:"editor-title",innerHTML:I.value.titleHtml},null,8,Y),(0,s.Wm)(U.Z,{"article-text":I.value.textHtml,"should-format":!0,version:parseInt(I.value.editorVersion,10)},null,8,["article-text","version"])],64)):((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[(0,s.wy)((0,s._)("textarea",{ref_key:"titleRef",ref:m,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),autofocus:"",class:"editor-title",cols:"5",placeholder:e.msg("EDITOR_MARKDOWN_TITLE_PLACEHOLDER"),rows:"1",type:"text",onInput:p,onKeydown:f},null,40,G),[[n.nr,c.value],[i]]),(0,s.wy)((0,s._)("textarea",{ref_key:"markdownRef",ref:r,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,b.dq)(l)?l.value=e:null),class:"editor-body",cols:"30",placeholder:e.msg("EDITOR_MARKDOWN_BODY_PLACEHOLDER"),rows:"30",onKeydown:T},null,40,V),[[n.nr,(0,b.SU)(l)],[i]])],64))])}}});var j=i(83744);const z=(0,j.Z)(q,[["__scopeId","data-v-d5aacffe"]]),K=z;var Z=i(2648),X=i(56104),J=i(61897),Q=i(28485),ee=i(40653),te=i(39639),ie=i(65904),se=i(15564),ae=i(78052),ne=i(21805),oe=i(36134),re=i(75633);const le={class:"tm-suggest-banners"},ue={class:"tm-suggest-banners__title"};function de(e,t,i,n,o,r){const l=(0,s.up)("router-link"),u=(0,s.up)("TMUserNotice"),d=(0,s.up)("TMFormBuilder");return(0,s.wg)(),(0,s.iD)("div",le,[(0,s._)("div",ue,(0,a.zw)(e.msg("PUBLICATION_MULTIWIDGETS_LABEL")),1),(0,s.Wm)(l,{class:"tm-suggest-banners__link",to:{name:"COMPANY_ADMIN_SETTINGS_MULTI_WIDGETS",params:{name:i.companyAlias}}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_MULTIWIDGETS_LINK")),1)])),_:1},8,["to"]),i.hasMultiwidgets?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:0,notice:r.tariffLimit},null,8,["notice"])),i.multiwidgets.length?((0,s.wg)(),(0,s.j4)(d,{key:1,disabled:!i.hasMultiwidgets,fields:r.formFields,"form-name":"suggestMultiwidgets","initial-data":o.initialData,lang:i.lang,"validate-on-blur":"","onUpdate:data":t[0]||(t[0]=t=>e.$emit("update:modelValue",t.suggestMultiwidgets))},null,8,["disabled","fields","initial-data","lang"])):(0,s.kq)("",!0)])}const ce={name:"TMSuggestMultiwidgets",components:{TMFormBuilder:O.Z,TMUserNotice:se["default"]},props:{multiwidgets:{type:Array,required:!0},modelValue:{type:String,default:null},hasMultiwidgets:{type:Boolean,required:!0},companyAlias:{type:String,required:!0},lang:{type:String,default:null}},emits:["update:modelValue"],data(){return{initialData:{suggestMultiwidgets:this.modelValue||"-1"}}},computed:{formFields(){return[{name:"suggestMultiwidgets",label:"",type:"BaseSelect",options:this.multiwidgets,validation:{required:!1},position:{row:"1",column:"1 / 7"}}]},tariffLimit(){return{level:"info",message:this.msg("COMPANY_ADMIN_MULTI_WIDGET_TARIFF_LIMIT"),isPermanent:!0}}}},me=(0,j.Z)(ce,[["render",de]]),he=me;var pe=i(84183),ge=i(71197),fe=i(89507),ve=i(62524),_e=i(68323),Te=i(25109),be=i(13862),we=i(80546),Ie=i(48070),Ae=i(86598),Ce=i(27204),Ee=i(67426),ye=i(72923),De=i(10707),Le=i(68357),Se=i(87032);const Me={isCorrectorConfirm:!1};function Pe(e){return[{className:"tm-checkbox",name:"isCorrectorConfirm",type:"BaseCheckbox",label:e("PUBLICATION_CORRECTED"),validation:{required:!1}}]}var Oe=i(88048);const ke={lang:null,title:null,feedCover:null,hubs:[],tags:[],companies:[],text:null,preview:null,leadButtonText:null,socialCover:null,socialDescription:null,trackerPixels:[{pixelLink:""}],type:"mega-post",customer:[],innerTags:[],isVotingDisabled:!1,isCommentsDisabled:!1,format:"common"},Ne=5,Be=14,Fe=15;function Ue({msg:e,hl:t,isMobile:i,hubsSuggest:s,companiesSuggest:a,WYSIWYGConfig:n}){return[{className:"tm-section",name:"PublicationHeader",label:e("PUBLICATION_SETTINGS"),type:"BaseSection",position:{row:"1",column:"1 / 7"}},{className:"tm-tabs-radio",label:e("PUBLICATION_LANG"),name:"lang",type:"TabsRadio",defaultValue:"ru",validation:{required:!0},options:[{name:e("PUBLICATION_LANG_RU"),value:"ru"},{name:e("PUBLICATION_LANG_EN"),value:"en"}],position:{row:"2",column:"1 / 7"}},{className:"tm-chips",label:e("MEGAPOST_COMPANIES"),allowCustomValue:!1,htmlAttrs:{placeholder:e("MEGAPOST_COMPANIES_PLACEHOLDER")},description:e("MEGAPOST_COMPANIES_HINT"),name:"companies",type:"BaseChips",suggest:a,validation:{required:!1,maxLength:1},position:{row:"3",column:"1 / 7"}},{name:"flow",type:"CustomField",position:{row:"4",column:"1 / 7"}},{className:"tm-chips",label:e("PUBLICATION_HUBS"),allowCustomValue:!1,htmlAttrs:{placeholder:e("PUBLICATION_HUBS_PLACEHOLDER")},description:e("PUBLICATION_HUBS_HINT"),name:"hubs",type:"BaseChips",suggest:s,validation:{required:!0,minLength:1,maxLength:5},position:{row:"5",column:"1 / 7"}},{className:"tm-chips-outline",label:e("PUBLICATION_KEYWORDS"),htmlAttrs:{placeholder:e("PUBLICATION_KEYWORDS")},description:e("PUBLICATION_KEYWORDS_HINT"),name:"tags",type:"BaseChips",allowCustomValue:!0,extraSeparator:",",suggest:[],validation:{required:!0,minLength:1,maxLength:10},position:{row:"6",column:"1 / 7"}},{className:"tm-section",name:"PublicationSecondHeader",label:e("PUBLICATION_FEED_VIEW"),type:"BaseSection",position:{row:"7",column:"1 / 7"}},{className:"tm-cover",label:e("PUBLICATION_ADD_COVER"),description:e("PUBLICATION_ADD_COVER_DESCRIPTION"),name:"feedCover",type:"BaseCover",clickTextPlacement:"standalone",sizeX:780,sizeY:440,validation:{maxSize:1e6,maxWidth:5e3,maxHeight:5e3,required:!0},position:{row:"8 / 9",column:"1 / 7"},htmlAttrs:{accept:".png, .jpg, .jpeg, .gif"}},{className:"tm-leadtext",description:e("PUBLICATION_TEXT_BEFORE_CUT_HINT"),label:"",name:"preview",type:ae.Z,lang:t,isMobile:i,useTestIds:!1,propsConfig:n,validation:{required:!0,maxCharsLimit:3e3,nodesLimit:{}},position:{row:"9 / 10",column:"1 / 7"}},{className:"tm-input",label:e("PUBLICATION_CUT_BUTTON_TEXT"),description:null,name:"leadButtonText",type:"BaseInput",htmlAttrs:{placeholder:e(`PUBLICATION_CUT_BUTTON_TEXT_DEFAUlT_${t.toUpperCase()}`)},validation:{required:!0,minLength:0,maxLength:42},position:{row:"11",column:"1 / 7"}},{className:"tm-section",name:"PublicationThirdHeader",label:e("MEGAPOST_SHARING_TITLE"),type:"BaseSection",position:{row:"12",column:"1 / 7"}},{className:"tm-cover",label:e("MEGAPOST_SHARING_ADD_COVER"),description:e("MEGAPOST_SHARING_ADD_COVER_DESCRIPTION"),name:"socialCover",type:"BaseCover",clickTextPlacement:"standalone",sizeX:1200,sizeY:630,objectFit:"contain",validation:{maxSize:1e6,maxWidth:5e3,maxHeight:5e3,required:!0},position:{row:"13",column:"1 / 7"},htmlAttrs:{accept:".png, .jpg, .jpeg, .gif"}},{className:"tm-textarea",description:e("MEGAPOST_SOCIAL_DESCRIPTION_HINT"),name:"socialDescription",type:"BaseTextarea",disableCounter:!0,validation:{required:!1,maxLength:300},htmlAttrs:{placeholder:e("MEGAPOST_SOCIAL_DESCRIPTION_PLACEHOLDER")},position:{row:"14",column:"1 / 7"}},{type:"DynamicInputs",name:"trackerPixels",label:e("MEGAPOST_TRACKING_PIXELS"),validation:{required:!1,maxLength:3},position:{row:"15",column:"1 / 7"},addLabel:e("MEGAPOST_TRACKING_PIXEL_ADD"),fields:[{className:"tm-input",name:"pixelLink",type:"BaseInput",htmlAttrs:{placeholder:e("MEGAPOST_TRACKING_PIXEL_PLACEHOLDER")},validation:{required:!1}}]},{className:"",name:"type",label:e("MEGAPOST_TYPE"),type:"BaseSelect",options:Oe.G.map((t=>({...t,name:e(t.name)}))),validation:{required:!0},position:{row:"16",column:"1 / 7"}},{className:"tm-radio-group",label:e("PUBLICATION_FORMAT"),name:"format",type:"BaseRadio",hintUrl:"/docs/help/wysiwyg/#formats",validation:{required:!1},displayConditions:[{fieldName:"type",values:["mega-post"]}],options:[{name:e("PUBLICATION_FORMAT_NOT_SELECTED"),value:"common"},{name:e("PUBLICATION_FORMAT_CASE"),value:"case"},{name:e("PUBLICATION_FORMAT_TUTORIAL"),value:"tutorial"},{name:e("PUBLICATION_FORMAT_ROADMAP"),value:"roadmap"},{name:e("PUBLICATION_FORMAT_RETROSPECTIVE"),value:"retrospective"},{name:e("PUBLICATION_FORMAT_REVIEW"),value:"review"},{name:e("PUBLICATION_FORMAT_OPINION"),value:"opinion"},{name:e("PUBLICATION_FORMAT_FAQ"),value:"faq"},{name:e("PUBLICATION_FORMAT_INTERVIEW"),value:"interview"},{name:e("PUBLICATION_FORMAT_DIGEST"),value:"digest"},{name:e("PUBLICATION_FORMAT_REPORTAGE"),value:"reportage"},{name:e("PUBLICATION_FORMAT_ANALYTICS"),value:"analytics"}],position:{row:"17",column:"1 / 7"}},{className:"tm-radio-line",label:e("PUBLICATION_COMPLEXITY"),name:"complexity",type:"BaseRadio",hintUrl:"/docs/help/wysiwyg/#complexity",defaultValue:null,validation:{required:!1},options:[{name:e("PUBLICATION_COMPLEXITY_NOT_SET"),value:null},{name:e("PUBLICATION_COMPLEXITY_LOW"),value:"low"},{name:e("PUBLICATION_COMPLEXITY_MEDIUM"),value:"medium"},{name:e("PUBLICATION_COMPLEXITY_HIGH"),value:"high"}],position:{row:"18",column:"1 / 7"}},{className:"tm-chips-outline",label:e("MEGAPOST_CLIENT"),htmlAttrs:{placeholder:e("MEGAPOST_CLIENT_PLACEHOLDER")},description:e("MEGAPOST_CLIENT_HINT"),name:"customer",type:"BaseChips",allowCustomValue:!0,extraSeparator:",",suggest:[],validation:{required:!1,maxLength:1},position:{row:"19",column:"1 / 7"}},{className:"tm-chips-outline",label:e("MEGAPOST_INTERNAL_TAGS"),htmlAttrs:{placeholder:e("MEGAPOST_INTERNAL_TAGS_PLACEHOLDER")},name:"innerTags",type:"BaseChips",allowCustomValue:!0,extraSeparator:",",suggest:[],validation:{required:!1,maxLength:10},position:{row:"20",column:"1 / 7"}},{className:"tm-checkbox",name:"isVotingDisabled",type:"BaseCheckbox",label:e("MEGAPOST_DISABLE_VOTING"),validation:{required:!1},position:{row:"21",column:"1 / 7"}},{className:"tm-checkbox",name:"isCommentsDisabled",type:"BaseCheckbox",label:e("MEGAPOST_DISABLE_COMMENTS"),validation:{required:!1},position:{row:"22",column:"1 / 7"}}]}const xe={postCover:null};function Re(e){return[{className:"tm-post-cover",label:e("MEGAPOST_ADD_HEAD_COVER"),description:e("MEGAPOST_ADD_HEAD_COVER_DESCRIPTION"),clickTextPlacement:"standalone",name:"postCover",type:"BaseCover",sizeX:1560,sizeY:600,validation:{maxSize:1e6,maxWidth:5e3,maxHeight:5e3,required:!0},htmlAttrs:{accept:".png, .jpg, .jpeg, .gif"}}]}const We={isModerated:!1,isCompanyExperience:!1,isLocked:!1};function $e(e){return[{className:"tm-checkbox",name:"isLocked",type:"BaseCheckbox",label:e("PUBLICATION_LOCKED"),validation:{required:!1}},{className:"tm-checkbox",name:"isModerated",type:"BaseCheckbox",label:e("PUBLICATION_MODERATED"),validation:{required:!1}}]}const He={lang:null,type:"simple",title:null,feedCover:null,hubs:[],tags:[],text:null,preview:null,leadButtonText:null,isTranslation:null,format:"common",isPlanned:null,plannedDateTime:null,translationSource:null,originalAuthor:null},Ye=4,Ge=5,Ve=7,qe=16,je=15,ze=new RegExp(/^[A-Za-zА-Яа-яёЁ0-9\-_.$+#\s]+$/);function Ke({msg:e}){return{className:"tm-leadtext",label:"",description:e("PUBLICATION_TEXT_BEFORE_CUT_MD_HINT"),name:"preview",type:"TMMDLeadtext",validation:{required:!0,maxLength:3e3},position:{row:"17 / 18",column:"1 / 7"}}}function Ze({msg:e,isMobile:t,hl:i,WYSIWYGConfig:s}){return{className:"tm-leadtext",description:e("PUBLICATION_TEXT_BEFORE_CUT_HINT"),label:"",name:"preview",type:(0,b.Xl)(ae.Z),lang:i,isMobile:t,useTestIds:!1,propsConfig:s,validation:{required:!0,maxCharsLimit:3e3,nodesLimit:{}},position:{row:"17 / 18",column:"1 / 7"}}}function Xe({msg:e,isMobile:t,hl:i,WYSIWYGConfig:s,isSandbox:a,formFields:n,useMarkdown:o}){const r=[...n];let l;return l=a?je:qe,r[l]=o?Ke({msg:e}):Ze({msg:e,isMobile:t,hl:i,WYSIWYGConfig:s}),r}function Je({msg:e,hl:t,isMobile:i,WYSIWYGConfig:s,hubsSuggest:a,isSandbox:n,isEditForm:o,isDraft:r,useMarkdown:l,isNews:u,isArticle:d,hasTypeToggle:c}){return[{className:"tm-section",name:"PublicationHeader",label:e("PUBLICATION_SETTINGS"),type:"BaseSection",position:{row:"1",column:"1 / 7"}},{className:"tm-tabs-radio",label:e("PUBLICATION_TYPE"),name:"type",type:"TabsRadio",defaultValue:"simple",validation:{required:!0},options:[...d||n||c?[{name:e("PUBLICATION_TYPE_ARTICLE"),value:"simple"}]:[],...u||c?[{name:e("PUBLICATION_TYPE_NEWS"),value:"shortwrite"}]:[]],position:{row:"2",column:"1 / 7"},breakpoint:{1024:{position:{row:"2",column:"1 / 4"}}}},{className:"tm-tabs-radio",label:e("PUBLICATION_LANG"),name:"lang",type:"TabsRadio",defaultValue:"ru",validation:{required:!0},options:[{name:e("PUBLICATION_LANG_RU"),value:"ru"},{name:e("PUBLICATION_LANG_EN"),value:"en"}],position:{row:"3",column:"1 / 7"},breakpoint:{1024:{position:{row:"2",column:"4 / 6"}}}},{name:"flow",type:"CustomField",position:{row:"4",column:"1 / 7"}},{className:"tm-chips",label:e("PUBLICATION_HUBS"),htmlAttrs:{placeholder:e("PUBLICATION_HUBS_PLACEHOLDER")},description:e("PUBLICATION_HUBS_HINT"),name:"hubs",type:"BaseChips",suggest:a,validation:{required:!0,minLength:1,maxLength:5},position:{row:"5",column:"1 / 7"}},{className:"tm-hub-notice",name:"notice",text:e("PUBLICATION_HUBS_NOTICE"),type:"BaseNotice",variant:"warning",validation:{},position:{row:"6",column:"1 / 7"},displayConditions:[{fieldName:"hubs",values:[{alias:"465"},{alias:"19259"}]}]},{className:"tm-hub-notice",name:"notice",type:"BaseNotice",variant:"warning",validation:{},position:{row:"7",column:"1 / 7"},displayConditions:[{fieldName:"hubs",values:[]}]},{className:"tm-chips-outline",label:e("PUBLICATION_KEYWORDS"),htmlAttrs:{placeholder:e("PUBLICATION_KEYWORDS")},description:e("PUBLICATION_KEYWORDS_HINT"),name:"tags",type:"BaseChips",allowCustomValue:!0,extraSeparator:",",suggest:[],validation:{required:!0,minLength:1,maxLength:10},position:{row:"8",column:"1 / 7"}},...n?[]:[{className:"tm-radio-group",label:e("PUBLICATION_FORMAT"),name:"format",type:"BaseRadio",hintUrl:"/docs/help/wysiwyg/#formats",defaultValue:"common",validation:{required:!1},displayConditions:[{fieldName:"type",values:["simple"]}],options:[{name:e("PUBLICATION_FORMAT_NOT_SELECTED"),value:"common"},{name:e("PUBLICATION_FORMAT_CASE"),value:"case"},{name:e("PUBLICATION_FORMAT_TUTORIAL"),value:"tutorial"},{name:e("PUBLICATION_FORMAT_ROADMAP"),value:"roadmap"},{name:e("PUBLICATION_FORMAT_RETROSPECTIVE"),value:"retrospective"},{name:e("PUBLICATION_FORMAT_REVIEW"),value:"review"},{name:e("PUBLICATION_FORMAT_OPINION"),value:"opinion"},{name:e("PUBLICATION_FORMAT_FAQ"),value:"faq"},{name:e("PUBLICATION_FORMAT_INTERVIEW"),value:"interview"},{name:e("PUBLICATION_FORMAT_DIGEST"),value:"digest"},{name:e("PUBLICATION_FORMAT_REPORTAGE"),value:"reportage"},{name:e("PUBLICATION_FORMAT_ANALYTICS"),value:"analytics"}],position:{row:"9",column:"1 / 7"}}],{className:"tm-section-light",name:"PublicationSecondHeader",label:e("PUBLICATION_TRANSLATION"),type:"BaseSection",position:{row:"10",column:"1 / 7"},displayConditions:[{fieldName:"type",values:["simple"]}]},{className:"tm-checkbox",name:"isTranslation",type:"BaseCheckbox",label:e("PUBLICATION_TRANSLATION_LABEL"),validation:{required:!1},displayConditions:[{fieldName:"type",values:["simple"]}],position:{row:"11",column:"1 / 7"}},{className:"tm-input",label:e("PUBLICATION_TRANSLATION_AUTHOR"),description:e("PUBLICATION_TRANSLATION_AUTHOR_HINT"),name:"originalAuthor",type:"BaseInput",displayConditions:[{fieldName:"isTranslation",values:[!0]},{fieldName:"type",values:["simple"]}],validation:{required:!0,minLength:1,maxLength:200},position:{row:"12",column:"1 / 7"}},{className:"tm-input",label:e("PUBLICATION_TRANSLATION_SOURCE"),description:e("PUBLICATION_TRANSLATION_SOURCE_HINT"),name:"translationSource",type:"BaseInput",displayConditions:[{fieldName:"isTranslation",values:[!0]},{fieldName:"type",values:["simple"]}],validation:{required:!0,minLength:1,maxLength:200},position:{row:"13",column:"1 / 7"}},{className:"tm-radio-line",label:e("PUBLICATION_COMPLEXITY"),name:"complexity",type:"BaseRadio",hintUrl:"/docs/help/wysiwyg/#complexity",defaultValue:null,validation:{required:!1},displayConditions:[{fieldName:"type",values:["simple"]}],options:[{name:e("PUBLICATION_COMPLEXITY_NOT_SET"),value:null},{name:e("PUBLICATION_COMPLEXITY_LOW"),value:"low"},{name:e("PUBLICATION_COMPLEXITY_MEDIUM"),value:"medium"},{name:e("PUBLICATION_COMPLEXITY_HIGH"),value:"high"}],position:{row:"14",column:"1 / 7"}},{className:"tm-section",name:"PublicationThirdHeader",label:e("PUBLICATION_FEED_VIEW"),type:"BaseSection",position:{row:"15",column:"1 / 7"}},{className:"tm-cover",label:e("PUBLICATION_ADD_COVER"),description:e("PUBLICATION_ADD_COVER_DESCRIPTION"),name:"feedCover",type:"BaseCover",clickTextPlacement:"standalone",sizeX:780,sizeY:440,validation:{maxSize:1e6,maxWidth:5e3,maxHeight:5e3},position:{row:"16 / 17",column:"1 / 7"},htmlAttrs:{accept:".png, .jpg, .jpeg, .gif"},checkPreloadedImageSize:!0},...l?[Ke({msg:e})]:[Ze({msg:e,isMobile:i,hl:t,WYSIWYGConfig:s})],{className:"tm-input",label:e("PUBLICATION_CUT_BUTTON_TEXT"),description:null,name:"leadButtonText",type:"BaseInput",htmlAttrs:{placeholder:e(`PUBLICATION_CUT_BUTTON_TEXT_DEFAUlT_${t.toUpperCase()}`)},validation:{required:!0,minLength:0,maxLength:42},position:{row:"18",column:"1 / 7"}},...n||o&&!r?[]:[{className:"tm-checkbox",name:"isPlanned",type:"BaseCheckbox",label:e("PLAN_PUBLICATION"),defaultValue:!1,validation:{required:!1},position:{row:"19",column:"auto / auto"}}],{className:"tm-datetime",name:"plannedDateTime",type:"BaseDatetime",withTime:!0,disabledBefore:new Date,defaultValue:Ae.Ro.toISOString(),position:{row:"21",column:"1 / 7"},breakpoint:{1024:{position:{row:"19",column:"2 / 6"}}},validation:{required:!0},displayConditions:[{fieldName:"isPlanned",values:[!0]}]},...n?[]:[{className:"tm-section",name:"PublicationFourthHeader",label:"",type:"BaseSection",position:{row:"22",column:"1 / 7"}}]]}var Qe=i(42794),et=i(46329);const tt=["onClick"],it={__name:"publication-polls",props:{initialPollsData:{type:Array,required:!0},serverErrors:{type:Array,default:()=>[]}},emits:["update:data","update:error"],setup(e,{expose:t,emit:i}){const n=e,o=i,r=(0,b.iH)(!1),l=(0,b.iH)(n.initialPollsData),u=(0,b.iH)(null),{langOptions:d}=(0,oe.Q)();function c(e,t){const i={...t};t.isTimed&&!t.endDateTime&&(i.endDateTime=Ae.Ro.toISOString()),l.value[e]=i,o("update:data",{polls:l.value}),o("update:error",r.value)}function m(e,t){r.value=t,o("update:error",r.value)}function h(e){l.value.splice(e,1),o("update:data",{polls:l.value}),l.value.length||(r.value={}),o("update:error",r.value)}function p(){l.value.push((0,et.c)())}function g(e){if(!n.serverErrors||!n.serverErrors[e])return!1;const t=(0,Qe._B)(n.serverErrors[e]);return t}function f(){var e;null===(e=u.value)||void 0===e||e.forEach((e=>{e.validateForm()}))}return t({validate:f}),(e,t)=>((0,s.wg)(),(0,s.iD)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.value,((t,i)=>((0,s.wg)(),(0,s.iD)("div",{key:`poll-${t.id}-${i}`,class:"tm-publication__poll"},[(0,s._)("a",{class:"tm-publication__delete-poll tm-publication__link",onClick:e=>h(i)},(0,a.zw)(e.msg("POLLS_DELETE_POLL")),9,tt),(0,s.Wm)(O.Z,{ref_for:!0,ref_key:"pollFormRef",ref:u,fields:(0,b.SU)(et.i)(e.msg,t.id,i),"form-name":"pollForm","initial-data":t,lang:(0,b.SU)(d).hl,"server-errors":g(i),"validate-on-blur":"","onUpdate:data":e=>c(i,e),"onUpdate:error":e=>m(i,e)},null,8,["fields","initial-data","lang","server-errors","onUpdate:data","onUpdate:error"])])))),128)),(0,s._)("a",{class:"tm-publication__add-poll tm-publication__link",onClick:p},(0,a.zw)(e.msg("POLLS_ADD_POLL")),1)]))}},st=it,at=st,nt={class:"tm-suggest-banners"},ot={class:"tm-suggest-banners__title"};function rt(e,t,i,n,o,r){const l=(0,s.up)("router-link"),u=(0,s.up)("TMUserNotice"),d=(0,s.up)("TMFormBuilder");return(0,s.wg)(),(0,s.iD)("div",nt,[(0,s._)("div",ot,(0,a.zw)(e.msg("PUBLICATION_BANNERS_LABEL")),1),(0,s.Wm)(l,{class:"tm-suggest-banners__link",to:{name:"COMPANY_ADMIN_SETTINGS_BANNERS",params:{name:i.companyAlias}}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e.msg("PUBLICATION_BANNERS_LINK")),1)])),_:1},8,["to"]),i.hasPostBanners?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(u,{key:0,notice:r.tariffLimit},null,8,["notice"])),i.banners.length?((0,s.wg)(),(0,s.j4)(d,{key:1,disabled:!i.hasPostBanners,fields:r.formFields,"form-name":"suggestBanners","initial-data":o.initialData,lang:i.lang,"validate-on-blur":"","onUpdate:data":t[0]||(t[0]=t=>e.$emit("onBannersUpdateData",t))},null,8,["disabled","fields","initial-data","lang"])):(0,s.kq)("",!0)])}const lt={name:"TMSuggestBanners",components:{TMFormBuilder:O.Z,TMUserNotice:se["default"]},props:{banners:{type:Array,required:!0},chosenBanner:{type:String,default:null},hasPostBanners:{type:Boolean,required:!0},companyAlias:{type:String,required:!0},lang:{type:String,default:null}},emits:["onBannersUpdateData"],data(){return{initialData:{suggestBanners:this.chosenBanner||"-1"}}},computed:{formFields(){return[{name:"suggestBanners",label:"",type:"BaseSelect",options:this.banners,validation:{required:!1},position:{row:"1",column:"1 / 7"}}]},tariffLimit(){return{level:"info",message:this.msg("COMPANY_ADMIN_BANNERS_TARIFF_LIMIT"),isPermanent:!0}}}},ut=(0,j.Z)(lt,[["render",rt]]),dt=ut,ct="habr-wysiwyg-m",mt=3,ht={multiwidget(e,t){return e.lang===t.lang&&e.hub===t.hub}};function pt({msg:e,nameProp:t="title",isPublished:i="isPublished",message:s="PUBLICATION_SELECT_ITEM_DISABLED"}){return a=>({name:a[i]?a[t]:`${a[t]} (${e(s)})`,alias:a.id.toString()})}const gt={name:"TMPublication",components:{TMUserNotice:se["default"],TMSuggestMultiwidgets:he,TMAsyncConfirmationDialog:y.Z,TMBlock:L.Z,TMButtonBase:S.Z,TMMarkdownSwitcher:N.Z,TMPopup:J.Z,TMDatetime:M.Z,TMEmptyPlaceholder:P.Z,TMFormBuilder:O.Z,TMFullScreenLoading:k.Z,TMPage:X.Z,TMUserInfo:ie.Z,TMPublicationPolls:at,TMSvgImg:te.Z,TMSuggestBanners:dt,MarkdownEditor:K,MarkdownEditorPanel:Z.Z,TMPublicationSidebar:Q.Z,TMAutosaveInfo:D.Z,TMWysiwygEditor:ae.Z,SpecializationSelect:ee.Z},setup(){const e=(0,pe.s)(),{isDesktop:t,isMobile:i,isMobileOnly:a}=(0,E.Jk)(e),n=(0,ge.q)(),{user:o,isSuperAdmin:r,isModerator:l,isCorrector:u,isReadOnlyOrReadAndComment:d,userAlias:c,useMarkdownInArticles:m}=(0,E.Jk)(n),h=(0,b.iH)(0),p=A()((()=>{h.value=window.innerWidth}),50),g={passive:!0};(0,s.bv)((()=>{p(),window.addEventListener("resize",p,g)})),(0,s.Jd)((()=>{window.removeEventListener("resize",p,g)}));const f=(0,s.Fl)((()=>h.value<1024?0:-63)),v=(0,w.yj)();(0,ne.w)((()=>(0,fe.i)().loadSpecializationRefs(v.params.publicationId)));const _=(0,b.iH)(null),T=(0,b.iH)(!1);function I(){var e;null===(e=_.value)||void 0===e||e.showPreview()}function C(){var e;null===(e=_.value)||void 0===e||e.hidePreview()}function y(e){var t;null===(t=_.value)||void 0===t||t.executeCommand(e),T.value=!1}const D=(0,b.iH)(null);function L(){var e;null===(e=D.value)||void 0===e||e.focus(),T.value=!0}function S(){T.value=!1}const M=(0,b.iH)(null),{msg:P,langOptions:O}=(0,oe.Q)(),k=[e=>e&&e.id?"":P("PUBLICATION_TARGET_AUDIENCE_PlACEHOLDER")],N=(0,b.iH)("");return(0,s.YP)(M,(()=>{var e;null!==(e=M.value)&&void 0!==e&&e.flow&&(N.value=M.value.flow)}),{deep:!0}),{mobileMenuStickyOffset:f,mdEditor:_,mdPanel:D,hideMarkdownPreview:C,showMarkdownPreview:I,executeMarkdownCommand:y,handleMdPanelFocus:L,handleMdPanelBlur:S,isMarkdownNavigationDisabled:T,PUBLICATION_BUTTONS:we.Ft,flowError:N,serverErrors:M,flowValidation:k,isDesktop:t,isMobile:i,isMobileOnly:a,user:o,isSuperAdmin:r,isModerator:l,isCorrector:u,isReadOnlyOrReadAndComment:d,userAlias:c,useMarkdownInArticles:m,langOptions:O}},data(){return{idempotenceKey:null,showSandboxWarning:!1,isLoading:!0,isSaving:!1,editPostUsesMarkdown:!1,isRestoreForm:!1,step:1,userData:{},timePublished:null,formFields:[],formData:{},formErrorData:{},corpFeatures:{multiwidget:{data:{hub:null,lang:null,companyAlias:null,multiwidgets:null},model:null,visible:!1,accessible:!0}},showSuggestBanners:!1,showSuggestMultiwidgets:!1,hasBannerAccess:!0,hasMultiwidgetAccess:!0,bannersInfo:{hub:null,lang:null,companyAlias:null,hasPostBanners:!1,suggestBanners:null},multiwidgetsInfo:{hub:null,lang:null,companyAlias:null,hasPostBanners:!1,suggestBanners:null},chosenBanner:null,chosenMultiwidget:null,moderatorFormFields:[],moderatorFormData:{},correctorFormFields:[],correctorFormData:{},megapostHeaderFormFields:[],megapostHeaderFormData:{},coverPromise:Promise.resolve(null),savedDraft:null,WYSIWYGData:{},WYSIWYGTitle:"",WYSIWYGInitialProps:{embedHost:"https://embedd.srv.habr.com",imagesHost:(0,De.k)("publication/upload","v2"),mentionHost:(0,De.k)("publication/suggest-mention","v2"),imagesByUrlHost:(0,De.k)("publication/upload-url","v2")},WYSIWYGInit:!1,WYSIWYGIsMounted:!1,leadWYSIWYGConfig:null,markdownSource:null,markdownTitle:null,markdownPreviewVisible:!1,suggestHubs:[],suggestCompanies:[],isMediaContentLoading:!1}},head(){return{title:this.formTitle}},computed:{useMarkdownEditor(){return!this.isMegapost&&(this.isRestoreForm?this.editPostUsesMarkdown:this.useMarkdownInArticles)},publishButtonLabel(){return this.isPlanned?this.msg("PLAN_PUBLICATION_SHORT"):this.isDraft?this.msg("PUBLICATION_PUBLISH"):this.isEditForm?this.msg("PUBLICATION_SAVE"):this.msg("PUBLICATION_PUBLISH")},useTestIds(){return!1},isSandbox(){return this.$route.meta.isSandboxPage},isMegapost(){return this.$route.meta.isMegapostPage},isNewsPublication(){return"PUBLICATION_NEWS"===this.$route.name||"PUBLICATION_NEWS_EDIT"===this.$route.name},isArticlePublication(){return"PUBLICATION_ARTICLE"===this.$route.name||"PUBLICATION_ARTICLE_EDIT"===this.$route.name},isEditForm(){const{publicationId:e}=this.$route.params;return!!e},isDraft(){return this.formData&&"drafted"===this.formData.status},isPlanned(){return this.formData.isPlanned},disableNextStep(){const{text:e}=this.WYSIWYGData;if(this.isMediaContentLoading)return!0;if(this.useMarkdownEditor){if(!this.markdownSource||!this.markdownTitle)return!0;if(this.markdownSource.length<10)return!0}else{if(!e||!this.WYSIWYGTitle)return!0;const t=e.replace(this.WYSIWYGTitle,"");if(t.length<10)return!0}return!1},isMDSwitcherDisabled(){if(this.useMarkdownEditor){if(this.markdownSource&&this.markdownSource.length)return!0;if(this.markdownTitle&&this.markdownTitle.length)return!0}else{const{text:e}=this.WYSIWYGData;if(e&&e.length)return!0;if(this.WYSIWYGTitle&&this.WYSIWYGTitle.length)return!0}return!1},isTouchDevice(){return(0,be.b1)()},textDataLoading(){if(!this.useMarkdownEditor){const{text:e}=this.WYSIWYGData;return!this.WYSIWYGInit&&(this.isEditForm||this.isRestoreForm)&&!e}return!1},hasPollErrors(){return this.formErrorData&&Object.values(this.formErrorData).filter((e=>"object"===typeof e?Object.values(e).some((e=>"object"===typeof e?Object.values(e).some((e=>!!e)):!!e)):!!e)).length>0},isEmptyPollsVariant(){var e;const t=null===(e=this.formData)||void 0===e?void 0:e.polls;return!!t&&t.some((({variants:e,title:t})=>!t.trim()||e.some((e=>!e.variantTitle.trim()))))},disablePublish(){const{tags:e,hubs:t,isTranslation:i,originalAuthor:s,translationSource:a,leadButtonText:n,flow:o}=this.formData,r=e.length&&t.length,l=s&&a,u=n&&n.length;return!o||!r||!u||this.hasPollErrors||this.isEmptyPollsVariant||i&&!l},showFullScreenLoading(){return this.useMarkdownEditor?this.isLoading||this.isSaving:this.isLoading||this.isSaving||!this.WYSIWYGIsMounted},draftKey(){return this.isMegapost?this.isEditForm?`specials-${this.$route.params.publicationId}`:"specials-new":this.isNewsPublication?this.isEditForm?`news-${this.$route.params.publicationId}`:"news-new":this.isEditForm?`post-${this.$route.params.publicationId}`:"post-new"},formTitle(){return this.isNewsPublication?this.isEditForm?this.msg("PUBLICATION_NEWS_EDIT_TITLE"):this.msg("PUBLICATION_NEWS_TITLE"):this.isEditForm?this.msg("PUBLICATION_ARTICLE_EDIT_TITLE"):this.msg("PUBLICATION_ARTICLE_TITLE")},hasTypeToggle(){return this.isModerator||this.isSuperAdmin}},async mounted(){if(this.isReadOnlyOrReadAndComment&&!this.isSandbox){const e=this.isNewsPublication?"PUBLICATION_NEWS":"PUBLICATION_ARTICLE";this.$router.push({...this.$route,name:this.$route.name.replace(e,"PUBLICATION_SANDBOX")})}!this.isReadOnlyOrReadAndComment&&this.isSandbox&&"PUBLICATION_SANDBOX_EDIT"!==this.$route.name&&this.$router.push({...this.$route,name:this.$route.name.replace("PUBLICATION_SANDBOX","PUBLICATION_ARTICLE")});const{publicationId:e}=this.$route.params;if(this.isReadOnlyOrReadAndComment&&this.isSandbox&&!this.isEditForm){const e=await(0,ye.rM)({sandbox:"by_author",userAlias:this.userAlias});if(e&&e.articleRefs&&Object.values(e.articleRefs).forEach((e=>{"sbModerationPending"===e.status&&(this.showSandboxWarning=!0)})),this.showSandboxWarning)return}const t=()=>"confirm before leave";window.onbeforeunload=t;const i=(0,Ae.fp)(ct,this.draftKey);i&&(this.savedDraft=i);try{let t,i;if(this.isEditForm){const s=this.getLoaderFunction();({author:t,postForm:i}=await s(e))}const s=(0,_e.S)();await s.getWYSIWYGRulesRefsIfNotExist();const{postFull:a,postLead:n,megaPostFull:o,megaPostLead:r}=s.WYSIWYGRulesRefs;this.suggestHubs=this.isMegapost?await(0,$.K$)({post:e}):await(0,$.aW)({publicationType:"topic",postType:this.isEditForm?i.type:"simple",post:e,postContext:this.isSandbox?"sandbox":"topic"}),this.suggestCompanies=this.isMegapost?await(0,$.Ki)({post:e}):[],this.WYSIWYGInitialProps.extensions=this.isMegapost?o.elements:a.elements,this.WYSIWYGInitialProps.extensions.push("typograph");const l={extensions:this.isMegapost?r.elements:n.elements,autoFocus:!1,formName:"previewForm"};l.extensions.push("typograph"),this.leadWYSIWYGConfig=l,i&&t?(this.setPublicationData(i,t),this.redirectByType(i.type)):(this.formData={...this.isMegapost?ke:He,hubs:[],tags:[],...this.isMegapost?{}:{type:this.isNewsPublication?"shortwrite":"simple"}},this.moderatorFormData=We,this.correctorFormData=Me,this.megapostHeaderFormData=xe,this.setUserInfo());const u=this.isMegapost?Ue:Je;this.formFields=u({msg:this.msg,hl:this.langOptions.hl,isMobile:this.isMobile||this.isTouchDevice,WYSIWYGConfig:l,hubsSuggest:this.suggestHubs.map((e=>({...e,name:this.msg(e.name)}))),companiesSuggest:this.suggestCompanies.map((e=>({...e,name:this.msg(e.name)}))),isSandbox:this.isSandbox,isEditForm:this.isEditForm,isDraft:i&&"drafted"===i.status,useMarkdown:this.useMarkdownEditor,isNews:this.isNewsPublication,isArticle:this.isArticlePublication,hasTypeToggle:this.hasTypeToggle}),this.isSuperAdmin&&(this.moderatorFormFields=$e(this.msg));const d=this.getCorpHub(this.formData);d&&this.isSuperAdmin&&this.moderatorFormFields.push({className:"tm-checkbox",name:"isCompanyExperience",type:"BaseCheckbox",label:this.msg("PUBLICATION_COMPANY_EXPERIENCE"),validation:{required:!1}}),this.isMegapost&&(this.megapostHeaderFormFields=Re(this.msg));const c=t&&t.groups&&t.groups.includes("journalist");c&&(this.isCorrector||this.isSuperAdmin)&&(this.correctorFormFields=Pe(this.msg))}catch(s){const e=(0,Se.getHttpCode)(s),t={message:s.message||s,errorCode:(0,Se.getErrorCode)(s)};e&&(t.httpCode=e),(0,ve.E)().showError(t)}this.$nextTick((()=>{this.isLoading=!1,(0,ve.E)().markDataLoaded()}))},methods:{bem:Te.P,resetIdempotenceKey(){this.idempotenceKey=null},onPublicationDataUpdated(){this.resetIdempotenceKey(),this.debouncedLocalStorageSave()},getInitialPollsData(){return this.formData.polls||[]},onModeratorFormUpdateData(e){this.formData.isModerated=e.isModerated,this.formData.isCompanyExperience=e.isCompanyExperience,this.formData.isLocked=e.isLocked,this.onPublicationDataUpdated()},onCorrectorFormUpdateData(e){this.formData.isCorrectorConfirm=e.isCorrectorConfirm,this.onPublicationDataUpdated()},onMegapostHeaderFormUpdateData(e){this.$nextTick((()=>{this.megapostHeaderFormData=e,this.onPublicationDataUpdated()}))},onMegapostHeaderFormUpdateTempData(e){if(e.postCover){const{url:t}=e.postCover;if(t&&t.name){const i=new FormData;i.append("file",t,t.name),this.coverPromise=(0,$.Y2)(i).then((t=>{this.megapostHeaderFormData={...this.megapostHeaderFormData,postCover:{...e.postCover,url:t.url}}}))}else this.megapostHeaderFormData.postCover=e.postCover}},onFormUpdateData(e){const t={...e},i=this.getCorpHub(e);if(i||(t.isCompanyExperience=!1,this.moderatorFormFields=$e(this.msg)),i&&this.isSuperAdmin&&(this.moderatorFormFields=[...$e(this.msg),{className:"tm-checkbox",name:"isCompanyExperience",type:"BaseCheckbox",label:this.msg("PUBLICATION_COMPANY_EXPERIENCE"),validation:{required:!1}}]),e.hubs&&(this.checkPostLimitNotice(e.hubs),e.hubs.forEach((i=>{"465"===i.id&&e.hubs.length>1&&(t.hubs=[i],this.$toast.warning(this.msg("PUBLICATION_HUBS_SELF_PROMO_ONLY")))}))),e.tags!==this.formData.tags){const i=e.tags.at(-1);i&&!ze.test(i.name)&&(t.tags=this.formData.tags,this.$toast.warning(this.msg("PUBLICATION_KEYWORDS_NOTICE")))}if(e.lang!==this.formData.lang){const i=this.formData.lang.toUpperCase(),s=this.msg(`PUBLICATION_CUT_BUTTON_TEXT_DEFAUlT_${i}`),a=e.leadButtonText===s;if(a){const i=e.lang.toUpperCase(),s=this.msg(`PUBLICATION_CUT_BUTTON_TEXT_DEFAUlT_${i}`);t.leadButtonText=s}}e.isPlanned!==this.formData.isPlanned&&(t.plannedDateTime=Ae.Ro.toISOString()),this.suggestBannersByFormParams(e),this.suggestMultiwidgetsByFormParams(e),this.$nextTick((()=>{this.formData=t})),this.onPublicationDataUpdated()},onFormUpdateTempData(e){const t=this.isMegapost?Ne:Ve;if(e.tags?this.debouncedFetchSuggestTags(e.tags,t):this.formFields[t].suggest=[],e.feedCover){const{url:t}=e.feedCover;if(t&&t.name){const i=new FormData;i.append("file",t,t.name),this.coverPromise=(0,$.Y2)(i).then((t=>{this.formData={...this.formData,feedCover:{...e.feedCover,url:t.url}}}))}else this.formData.feedCover=e.feedCover}if(e.customer?this.debouncedFetchCustomers(e.customer):this.formFields[Be].suggest=[],e.innerTags?this.debouncedFetchInnerTags(e.innerTags):this.formFields[Fe].suggest=[],e.socialCover){const{url:t}=e.socialCover;if(t&&t.name){const i=new FormData;i.append("file",t,t.name),this.coverPromise=(0,$.Y2)(i).then((t=>{this.formData={...this.formData,socialCover:{...e.socialCover,url:t.url}}}))}else this.formData.socialCover=e.socialCover}},onBannersUpdateData(e){this.chosenBanner=e.suggestBanners},suggestBannersByFormParams(e,t=!0){if(!this.hasBannerAccess)return;const i=e.hubs.find((e=>e.isCorporative));if(!i)return this.showSuggestBanners=!1,void(this.chosenBanner=null);if(this.bannersInfo.lang===e.lang&&this.bannersInfo.hub===i.alias)return void(this.showSuggestBanners=!0);this.showSuggestBanners=!1;const{lang:s}=e,a=i.alias;(0,$.uI)({lang:s,hub:a,post:this.isEditForm?e.id:null}).then((e=>{const{hasPostBanners:i}=e.company,n=[];i&&n.push({name:this.msg("PUBLICATION_BANNERS_EMPTY"),alias:"-1"}),n.push(...e.data.map((e=>({name:e.isPublished?e.title:`${e.title} (${this.msg("PUBLICATION_BANNERS_DISABLED")})`,alias:e.id.toString()})))),this.bannersInfo={lang:s,hub:a,suggestBanners:n,hasPostBanners:i,companyAlias:e.company.alias},t&&(this.chosenBanner=null),this.showSuggestBanners=!0})).catch((e=>{403===(0,Se.getHttpCode)(e)?this.hasBannerAccess=!1:this.$toast.error(e.message)}))},suggestMultiwidgetsByFormParams(e,t=!0){if(!this.canUseCorpFeature("multiwidget"))return;const i=this.getCorpHub(e);if(!i)return this.hideCorpFeature("multiwidget"),void this.resetCorpFeature("multiwidget");const{lang:s}=e,a=i.alias;this.isCorpFeatureHydrated("multiwidget",{lang:s,hub:a})?this.showCorpFeature("multiwidget"):(this.hideCorpFeature("multiwidget"),(0,$.fR)({lang:s,hub:a,post:this.isEditForm?e.id:null}).then((e=>{const{hasMultiWidgets:i}=e.company,n=[];if(i){const t=pt({msg:this.msg});n.push({name:this.msg("PUBLICATION_MULTIWIDGETS_EMPTY"),alias:"-1"},...e.data.map(t))}this.setCorpFeatureData("multiwidget",{lang:s,hub:a,multiwidgets:n,hasMultiWidgets:i,companyAlias:e.company.alias}),t&&this.resetCorpFeature("multiwidget"),this.showCorpFeature("multiwidget")})).catch((e=>{this.handleCorpFeatureError("multiwidget",e)})))},canUseCorpFeature(e){return this.corpFeatures[e].accessible},setCorpFeatureAccessible(e,t){this.corpFeatures[e].accessible=t},showCorpFeature(e){this.corpFeatures[e].visible=!0},hideCorpFeature(e){this.corpFeatures[e].visible=!1},resetCorpFeature(e){this.corpFeatures[e].model=null},isCorpFeatureHydrated(e,t){const{data:i}=this.corpFeatures[e];return ht[e](i,t)},setCorpFeatureData(e,t){this.corpFeatures[e].data=t},handleCorpFeatureError(e,t){403===(0,Se.getHttpCode)(t)?this.setCorpFeatureAccessible("multiwidget",!1):this.$toast.error(t.message)},getCorpHub(e){return e.hubs.find((e=>e.isCorporative))},checkPostLimitNotice(e){const t=[],i=[],s=!!this.timePublished,a=this.isEditForm?this.formFields[Ye].suggest[0].list:[];e.forEach((e=>{const n=a.find((({id:t})=>t===e.id));if(!Number.isInteger(e.postsLeft)||s&&n||(t.push((0,Ae.fM)(e,this.msg)),i.push({id:e.id})),t.length){const e=`<p>${t.join("</p><p>")}</p>`;this.formFields[Ge].text=e,this.formFields[Ge].displayConditions=[{fieldName:"hubs",values:i}]}}))},onWYSIWYGMounted(){this.$nextTick((()=>{this.WYSIWYGIsMounted=!0}))},onWYSIWYGUpdate(e){const{json:t,textContent:i}=e,s=t.content,a=s[0];"title"===a.type&&(s.shift(),this.WYSIWYGTitle=this.buildTitleContent(a)),this.WYSIWYGData={json:{type:"doc",content:s},text:i},i.length&&this.WYSIWYGInit?this.debouncedLocalStorageSave():(this.checkSavedDrafts(),this.WYSIWYGInit=!0)},onTypographApplied(){this.$toast.success(this.msg("PUBLICATION_TYPOGRAPH_APPLIED"))},buildTitleContent(e){return e.content?e.content.map((e=>e.text)).join(""):""},onPollsUpdateData(e){this.serverErrors&&this.serverErrors.polls&&(this.serverErrors.polls=!1),this.formData.polls=e.polls,this.onPublicationDataUpdated()},onPollsUpdateErrorData(e){this.formErrorData=e},debouncedFetchCustomers:A()((function(e){return(0,$.wO)({q:e}).then((({data:e})=>{e.length?this.formFields[Be].suggest=[{name:this.msg("MEGAPOST_CLIENT"),list:e}]:this.formFields[Be].suggest=[]}))}),300),debouncedFetchInnerTags:A()((function(e){return(0,$.P7)({q:e}).then((({data:e})=>{e.length?this.formFields[Fe].suggest=[{name:this.msg("MEGAPOST_INTERNAL_TAGS"),list:e}]:this.formFields[Fe].suggest=[]}))}),300),debouncedFetchSuggestTags:A()((function(e,t){return(0,$.mj)({q:e}).then((({tags:e})=>{e.length?this.formFields[t].suggest=[{name:this.msg("PUBLICATION_KEYWORDS"),list:e}]:this.formFields[t].suggest=[]}))}),300),restoreDraft(){const e=window.confirm(this.msg("PUBLICATION_RESTORE_ACTION_ALERT"));if(e){const{author:e,postForm:t}=this.savedDraft;this.savedDraft=null,this.setPublicationData(t,e),this.isEditForm||e.alias===this.user.alias||this.setUserInfo()}},checkSavedDrafts(){const e=(0,Ae.fp)(ct,this.draftKey),t=this.buildFormData({isDraft:!1});e&&JSON.stringify(e)!==JSON.stringify(t)&&(this.savedDraft=e)},getDraftTitle(e){if(e&&e.length){const t=25;return e.length>t?`${e.slice(0,t-1)}…`:e}return this.msg("PUBLICATION_DRAFT_UNNAMED")},debouncedLocalStorageSave:A()((function(){const e=this.isNewsPublication?"news-new":"post-new",t={author:this.userData,postForm:this.buildFormData({isDraft:!0}),savedDate:new Date};(0,Ae.cv)(t,e,this.draftKey,ct,mt),this.savedDraft=null}),3e3),clearFromLocalStorage(){this.resetIdempotenceKey(),(0,Ae.dV)(ct,this.draftKey),this.savedDraft=null},async setStep(e){if(!this.isMegapost||!await this.validateFormsAndShowErrors()){if(2===e){if(this.isRestoreForm||(this.isMegapost||(this.formFields=Xe({msg:this.msg,hl:this.langOptions.hl,isMobile:this.isMobile||this.isTouchDevice,useMarkdown:this.useMarkdownEditor,isSandbox:this.isSandbox,WYSIWYGConfig:this.leadWYSIWYGConfig,formFields:this.formFields})),this.useMarkdownEditor&&"string"!==typeof this.formData.preview&&(this.formData.preview=""),this.useMarkdownEditor||"string"!==typeof this.formData.preview||(this.formData.preview=null)),!this.formData.preview&&!this.useMarkdownEditor){await this.$refs.editor.awaitPendingOperations();const e=this.formFields.find((e=>"preview"===e.name));if(!e)return;const t=(0,Ae.CW)(this.WYSIWYGData);e.propsConfig.initialJSON=JSON.stringify({type:"doc",content:t})}if(this.isEditForm||this.formData.feedCover||(this.formData.feedCover={url:(0,Ae.ms)(this.WYSIWYGData),positionX:0,positionY:0,fit:"cover"}),!this.isEditForm&&!this.formData.lang){const e=this.useMarkdownEditor?this.markdownSource:this.WYSIWYGData.text,t=/[а-яА-Я]/.test(e),i=t?"ru":"en",s=i.toUpperCase(),a=this.msg(`PUBLICATION_CUT_BUTTON_TEXT_DEFAUlT_${s}`);this.formData.lang=i,this.formData.leadButtonText=a}}this.step=e,window.scrollTo({top:0,behavior:"smooth"})}},buildMegapostHeaderFormData(){return{...this.megapostHeaderFormData,postCover:this.megapostHeaderFormData.postCover&&this.megapostHeaderFormData.postCover.url?this.megapostHeaderFormData.postCover:null}},onMDEditorUpdateData(e){this.markdownSource=e.body,this.markdownTitle=e.title,this.onPublicationDataUpdated()},onMDEditorPreview({visible:e}){this.markdownPreviewVisible=e},buildFormData({isDraft:e}){let t,i,s;return this.useMarkdownEditor?(t=this.markdownSource,i=this.formData.preview,s=this.markdownTitle):(t=this.WYSIWYGData.json?JSON.stringify(this.WYSIWYGData.json):null,i=this.formData.preview?JSON.stringify(this.formData.preview.json):null,s=this.WYSIWYGTitle),{...this.formData,status:e?"drafted":"published",hubs:this.formData.hubs.map((e=>e.id)),tags:this.formData.tags.map((e=>e.name)),feedCover:this.formData.feedCover&&this.formData.feedCover.url?this.formData.feedCover:null,title:s,text:{source:t,editorVersion:2,isMarkdown:this.useMarkdownEditor},preview:{source:i,editorVersion:2,isMarkdown:this.useMarkdownEditor},banner:this.chosenBanner,multiwidget:this.corpFeatures.multiwidget.model,...this.isMegapost?{...this.buildMegapostHeaderFormData(),companies:this.formData.companies.map((e=>e.alias)),trackerPixels:this.formData.trackerPixels.map((({pixelLink:e})=>e)),socialCover:this.formData.socialCover&&this.formData.socialCover.url?this.formData.socialCover:null,innerTags:this.formData.innerTags.map((e=>e.name)),customer:this.formData.customer.length?this.formData.customer[0].name:null}:{}}},getSaveFunction(){return this.isSandbox?Le.db:this.isMegapost?$["in"]:$.D5},getRedirectRouteName(){return this.isSandbox?Ie.VU.ARTICLE_SANDBOX:this.isMegapost?Ie.VU.SPECIAL:Ie.VU.ARTICLE},getLoaderFunction(){return this.isSandbox?Le.a$:this.isMegapost?$.pG:$.EC},confirmAndProceedForm({isDraft:e}){const t=this.isPlanned?this.msg("PUBLICATION_SCHEDULE_ACTION_ALERT"):this.msg("PUBLICATION_PUBLISH_ACTION_ALERT");this.$refs.confirmDialog.show({title:t,confirmLabel:this.msg("NAV_OK"),cancelLabel:this.msg("NAV_CANCEL")}).then((t=>{t&&this.proceedForm({isDraft:e})}))},handleAutocompleteError(){this.$toast.error(this.msg("PUBLICATION_TARGET_AUDIENCE_PlACEHOLDER"));const e=document.getElementById("autocomplete-select");e&&(0,Ee.kI)(e)},async handlePollsErrors(e){const t=Object.values(e.polls),i=(0,W.r6)(t.map((e=>{var t,i;return(null===(t=e.title)||void 0===t?void 0:t[0])||(null===(i=e.variants)||void 0===i?void 0:i[0])})).find((e=>e)));this.$toast.error(i||this.msg("PUBLICATION_FORM_ERRORS"));const s=Object.entries(e.polls).reduce(((e,[t,i])=>(e[t]=i,e)),[]);this.serverErrors={polls:s},this.$refs.polls&&await(0,Ce.Jn)(this.$refs.polls.$el)},async validateFormsAndShowErrors(){var e,t,i,s;null===(e=this.$refs.megapostHeaderFormRef)||void 0===e||e.validateForm(),null===(t=this.$refs.publicationFormRef)||void 0===t||t.validateForm(),null===(i=this.$refs.specializationSelectRef)||void 0===i||i.validate(),null===(s=this.$refs.polls)||void 0===s||s.validate(),await this.$nextTick();const a=(0,Ee.Ab)();return a},async proceedForm({isDraft:e}){if(await this.validateFormsAndShowErrors())return;this.isSaving=!0,this.serverErrors=null;const{publicationId:t}=this.$route.params,i=this.getSaveFunction();try{await this.coverPromise,this.idempotenceKey??=(0,C.x)();const s=await i(this.buildFormData({isDraft:e}),t,this.idempotenceKey);if(s&&s.post){window.onbeforeunload=()=>{},this.clearFromLocalStorage();const e={name:this.getRedirectRouteName(),params:{id:s.post}},t=this.$router.resolve(e).href;window.location.href=t}}catch(n){var a;if(this.isSaving=!1,"RECOVERY_MODE_RESTRICTION"===n.errorCode&&null!==(a=n.data)&&void 0!==a&&a.nextAllowedAt){const{hl:e}=this.langOptions;return void this.$toast.error((0,s.h)("div",{class:"publication-error-toast",innerHTML:(0,re.w)(e,"PUBLICATION_RECOVERY_MODE_RESTRICTION",{nextAllowedAt:new Date(n.data.nextAllowedAt)})}))}const e=(0,W.TU)(n);if(!e&&n.message)return void this.$toast.error(n.message);if(!e)return void this.$toast.error(this.msg("ERROR_PAGE_MESSAGE_INTERNAL"));if(null!==e&&void 0!==e&&e.flow&&"object"===typeof e.flow)return void this.handleAutocompleteError();if(e.polls&&"object"===typeof e.polls)return void await this.handlePollsErrors(e);this.serverErrors=(0,Ae.RC)(e);const{content:t,hasFirstStepErrors:i}=this.serverErrors;if(t)return i&&await this.setStep(1),this.$toast.error(t),void this.$nextTick(Ee.Ab);if(Object.values(this.serverErrors).length)return this.$toast.error(this.msg("PUBLICATION_FORM_ERRORS")),void this.$nextTick(Ee.Ab);this.$toast.error(this.msg("ERROR_PAGE_MESSAGE_INTERNAL"))}},setPublicationData(e,t){this.userData=t,this.isRestoreForm=!0,e&&e.text.isMarkdown&&(this.editPostUsesMarkdown=!0);const i=[];this.suggestHubs.forEach((t=>{t.list.forEach((t=>{const s=e.hubs.map(String).indexOf(t.id.toString());-1!==s&&i.push(t)}))}));const s=[];this.suggestCompanies.forEach((t=>{t.list.forEach((t=>{const i=e.companies.map(String).indexOf(t.alias.toString());-1!==i&&s.push(t)}))}));let a=null;if(a=this.useMarkdownEditor?e.preview.source||"":{json:e.preview.source?JSON.parse(e.preview.source):null},this.formData={...e,hubs:i,tags:e.tags.map((e=>({name:e}))),preview:a,...this.isMegapost?{customer:e.customer?[{name:e.customer}]:[],companies:s,innerTags:e.innerTags.map((e=>({name:e}))),trackerPixels:e.trackerPixels.map((e=>({pixelLink:e}))),isCommentsDisabled:e.isCommentsDisabled,isVotingDisabled:e.isVotingDisabled}:{}},this.timePublished=e.publishedAt,this.isLoading=!0,this.useMarkdownEditor)this.markdownSource=e.text.source,this.markdownTitle=e.title;else{const t=JSON.parse(e.text.source);t.content.unshift({type:"title",content:[{type:"text",text:e.title}]}),this.WYSIWYGInitialProps.initialJSON=JSON.stringify(t)}this.$nextTick((()=>{this.isLoading=!1})),this.moderatorFormData={isModerated:e.isModerated,isCompanyExperience:e.isCompanyExperience,isLocked:e.isLocked},this.correctorFormData={isCorrectorConfirm:e.isCorrectorConfirm};const n={};Object.keys(xe).forEach((t=>{n[t]=e[t]})),this.megapostHeaderFormData={...n},this.formData.hubs&&(this.suggestBannersByFormParams(this.formData,!1),this.chosenBanner=this.formData.banner,this.suggestMultiwidgetsByFormParams(this.formData,!1),this.corpFeatures.multiwidget.model=this.formData.multiwidget)},setUserInfo(){this.userData={avatarUrl:this.user.image||this.user.avatarUrl,login:this.user.alias,alias:this.user.alias}},redirectByType(e){"shortwrite"!==e||this.isNewsPublication?"simple"===e&&this.isNewsPublication&&this.$router.push({...this.$route,name:this.$route.name.replace("PUBLICATION_NEWS","PUBLICATION_ARTICLE")}):this.$router.push({...this.$route,name:this.$route.name.replace("PUBLICATION_ARTICLE","PUBLICATION_NEWS")})},onMediaContentLoading(e){this.isMediaContentLoading=e}},beforeUnmount(){window.onbeforeunload=()=>{}}},ft=(0,j.Z)(gt,[["render",T]]),vt=ft}}]);
//# sourceMappingURL=publication.b0fd5667.js.map