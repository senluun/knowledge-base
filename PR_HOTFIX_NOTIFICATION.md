# üö® HOTFIX: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ Notification

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–û—à–∏–±–∫–∞:** `Notification() got unexpected keyword arguments: 'related_object_id'`

–≠—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—å–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ—ë –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—å–∏ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.

## –ü—Ä–∏—á–∏–Ω–∞

–í –º–æ–¥–µ–ª–∏ `Notification` (—Ñ–∞–π–ª `moderation/models.py`) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ `related_object_id`, –Ω–æ –∫–æ–¥ –≤ `knowledge/views.py` –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –§–∞–π–ª: `knowledge/views.py` (—Å—Ç—Ä–æ–∫–∏ 362-365)

**–ë—ã–ª–æ (‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
Notification.objects.create(
    user=moderator,
    title='–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
    message=f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {article.author.get_full_name()} —Å–æ–∑–¥–∞–ª –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é "{article.title}" –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –µ—ë –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.',
    notification_type='new_article',
    related_object_id=article.id  # ‚ùå –≠—Ç–æ–≥–æ –ø–æ–ª—è –ù–ï–¢ –≤ –º–æ–¥–µ–ª–∏!
)
```

**–°—Ç–∞–ª–æ (‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û):**
```python
Notification.objects.create(
    user=moderator,
    title='–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
    message=f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {article.author.get_full_name()} —Å–æ–∑–¥–∞–ª –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é "{article.title}" –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –µ—ë –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ.',
    notification_type='moderation_required'  # ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
)
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

- ‚ùå –£–¥–∞–ª–µ–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `related_object_id`
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω `notification_type` —Å `'new_article'` –Ω–∞ `'moderation_required'` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤ NOTIFICATION_TYPES)
- ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏ Notification

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
# –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
‚ùå TypeError: Notification() got unexpected keyword arguments: 'related_object_id'
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞
‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º
‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

1. –í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é
3. –í—ã–±–µ—Ä–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é"
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ç—å—è —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## –ú–æ–¥–µ–ª—å Notification –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ `Notification`:
```python
class Notification(models.Model):
    user = models.ForeignKey(User, ...)
    notification_type = models.CharField(...)  # ‚úÖ
    title = models.CharField(...)              # ‚úÖ
    message = models.TextField(...)            # ‚úÖ
    is_read = models.BooleanField(...)
    created_at = models.DateTimeField(...)
    suggestion = models.ForeignKey(ContentSuggestion, ...)  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    # related_object_id - –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢! ‚ùå
```

–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `notification_type`:
- `'suggestion_approved'`
- `'suggestion_rejected'`
- `'suggestion_needs_revision'`
- `'new_suggestion'`
- `'moderation_required'` ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ)
- `'system'`

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç

üî¥ **CRITICAL** - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç–µ–π)

## –°–≤—è–∑–∞–Ω–Ω—ã–µ Issues

Closes #3
Fixes #notification-error

## Checklist

- [x] –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] Django check –ø—Ä–æ–π–¥–µ–Ω (0 –æ—à–∏–±–æ–∫)
- [x] –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ
- [x] –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
- [x] –í–µ—Ç–∫–∞ –∑–∞–ø—É—à–µ–Ω–∞ –≤ GitHub
- [ ] Pull Request —Å–æ–∑–¥–∞–Ω
- [ ] –ö–æ–¥-—Ä–µ–≤—å—é –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –°–º–µ—Ä–¥–∂–µ–Ω–æ –≤ main
- [ ] Production –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] Python –∫–µ—à –æ—á–∏—â–µ–Ω –Ω–∞ production (`./clear_cache.sh`)

## Deployment Notes

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –º–µ—Ä–∂–∞ –≤ `main` –∏ –¥–µ–ø–ª–æ—è –Ω–∞ production –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –û—á–∏—Å—Ç–∏—Ç—å Python –∫–µ—à:
   ```bash
   ./clear_cache.sh
   ```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Django —Å–µ—Ä–≤–µ—Ä:
   ```bash
   # Development
   python manage.py runserver
   
   # Production (gunicorn)
   pkill -HUP gunicorn
   
   # Production (systemd)
   sudo systemctl restart your-service-name
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç–∞—Ç—å—é
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫

---

## –ü–æ—á–µ–º—É PR #2 –Ω–µ –ø–æ–º–æ–≥?

PR #2 –±—ã–ª —Å–º–µ—Ä–∂–µ–Ω **–î–û** —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –í PR #2 –≤—Ö–æ–¥–∏–ª –∫–æ–º–º–∏—Ç `d9f6513`, –∫–æ—Ç–æ—Ä—ã–π –ù–ï —Å–æ–¥–µ—Ä–∂–∞–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Notification. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –ø–æ–∑–∂–µ –≤ –∫–æ–º–º–∏—Ç–µ `aa1d11d`, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–ª—Å—è –≤ –≤–µ—Ç–∫–µ `fix/create-article-editor-issues` –∏ –Ω–µ –ø–æ–ø–∞–ª –≤ `main`.

## Branch Strategy

- `main` - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ (—Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–≥)
- `hotfix/notification-related-object-id` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ (—ç—Ç–æ—Ç PR)
- –ü–æ—Å–ª–µ –º–µ—Ä–∂–∞ –±–∞–≥–∞ –Ω–µ –±—É–¥–µ—Ç –≤ `main`
